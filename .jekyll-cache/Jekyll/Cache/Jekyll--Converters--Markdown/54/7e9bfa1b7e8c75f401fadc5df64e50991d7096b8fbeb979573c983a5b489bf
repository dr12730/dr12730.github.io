I"ğn<!-- vim-markdown-toc GFM -->

<ul>
  <li><a href="#é˜²ç«å¢™">é˜²ç«å¢™</a>
    <ul>
      <li><a href="#ç½‘ç»œé…ç½®">ç½‘ç»œé…ç½®</a>
        <ul>
          <li><a href="#é…ç½®è™šæ‹Ÿæœºç½‘å¡">é…ç½®è™šæ‹Ÿæœºç½‘å¡</a></li>
        </ul>
      </li>
      <li><a href="#é˜²ç«å¢™ç®¡ç†å·¥å…·">é˜²ç«å¢™ç®¡ç†å·¥å…·</a></li>
      <li><a href="#iptables">Iptables</a>
        <ul>
          <li><a href="#ç­–ç•¥ä¸è§„åˆ™é“¾">ç­–ç•¥ä¸è§„åˆ™é“¾</a>
            <ul>
              <li><a href="#drop-ä¸-reject-çš„åŒºåˆ«">drop ä¸ reject çš„åŒºåˆ«</a></li>
            </ul>
          </li>
          <li><a href="#åŸºæœ¬çš„å‘½ä»¤å‚æ•°">åŸºæœ¬çš„å‘½ä»¤å‚æ•°</a>
            <ul>
              <li><a href="#å¸¸ç”¨çš„å‚æ•°ä»¥åŠä½œç”¨">å¸¸ç”¨çš„å‚æ•°ä»¥åŠä½œç”¨</a></li>
              <li><a href="#ç¤ºä¾‹">ç¤ºä¾‹</a>
                <ul>
                  <li><a href="#å‚æ•°æŸ¥çœ‹å·²æœ‰çš„é˜²ç«å¢™è§„åˆ™é“¾">å‚æ•°æŸ¥çœ‹å·²æœ‰çš„é˜²ç«å¢™è§„åˆ™é“¾</a></li>
                  <li><a href="#æ¸…ç©ºå·²æœ‰çš„é˜²ç«å¢™è§„åˆ™é“¾">æ¸…ç©ºå·²æœ‰çš„é˜²ç«å¢™è§„åˆ™é“¾</a></li>
                  <li><a href="#æŠŠ-input-è§„åˆ™é“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºæ‹’ç»">æŠŠ INPUT è§„åˆ™é“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºæ‹’ç»</a></li>
                  <li><a href="#å‘-input-é“¾ä¸­æ·»åŠ å…è®¸-icmp-æµé‡è¿›å…¥çš„ç­–ç•¥è§„åˆ™">å‘ INPUT é“¾ä¸­æ·»åŠ å…è®¸ ICMP æµé‡è¿›å…¥çš„ç­–ç•¥è§„åˆ™</a></li>
                  <li><a href="#é»˜è®¤ç­–ç•¥ä¸ºå…è®¸ä½†ä¸å…è®¸-icmp">é»˜è®¤ç­–ç•¥ä¸ºå…è®¸ï¼Œä½†ä¸å…è®¸ ICMP</a></li>
                  <li><a href="#åªå…è®¸æŒ‡å®šç½‘æ®µè®¿é—®">åªå…è®¸æŒ‡å®šç½‘æ®µè®¿é—®</a></li>
                  <li><a href="#æ‹’ç»æ‰€æœ‰äººè®¿é—®æœ¬æœº-12345-ç«¯å£">æ‹’ç»æ‰€æœ‰äººè®¿é—®æœ¬æœº 12345 ç«¯å£</a></li>
                  <li><a href="#æ‹’ç»æ‰€æœ‰ä¸»æœºè®¿é—®-10001024-ç«¯å£">æ‹’ç»æ‰€æœ‰ä¸»æœºè®¿é—® 1000~1024 ç«¯å£</a></li>
                  <li><a href="#æ³¨æ„ä¿å­˜æŒ‡ä»¤">æ³¨æ„ä¿å­˜æŒ‡ä»¤</a></li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#firewalld">Firewalld</a>
        <ul>
          <li><a href="#å¸¸ç”¨çš„åŒºåŸŸåç§°åŠç­–ç•¥è§„åˆ™">å¸¸ç”¨çš„åŒºåŸŸåç§°åŠç­–ç•¥è§„åˆ™</a></li>
          <li><a href="#ç»ˆç«¯ç®¡ç†å·¥å…·-firewall-cmd">ç»ˆç«¯ç®¡ç†å·¥å…· firewall-cmd</a>
            <ul>
              <li><a href="#å®ä¾‹">å®ä¾‹</a>
                <ul>
                  <li><a href="#æŸ¥çœ‹-firewalld-æœåŠ¡å½“å‰æ‰€ä½¿ç”¨çš„åŒºåŸŸ">æŸ¥çœ‹ firewalld æœåŠ¡å½“å‰æ‰€ä½¿ç”¨çš„åŒºåŸŸ</a></li>
                  <li><a href="#æŸ¥è¯¢ç½‘å¡åœ¨-firewalld-æœåŠ¡ä¸­çš„åŒºåŸŸ">æŸ¥è¯¢ç½‘å¡åœ¨ firewalld æœåŠ¡ä¸­çš„åŒºåŸŸ</a></li>
                  <li><a href="#ç½‘å¡çš„é»˜è®¤åŒºåŸŸä¿®æ”¹ä¸º-external">ç½‘å¡çš„é»˜è®¤åŒºåŸŸä¿®æ”¹ä¸º external</a></li>
                  <li><a href="#æŠŠ-firewalld-æœåŠ¡çš„å½“å‰é»˜è®¤åŒºåŸŸè®¾ç½®ä¸º-public">æŠŠ firewalld æœåŠ¡çš„å½“å‰é»˜è®¤åŒºåŸŸè®¾ç½®ä¸º public</a></li>
                  <li><a href="#å¯åŠ¨å…³é—­æ€¥çŠ¶å†µæ¨¡å¼">å¯åŠ¨/å…³é—­æ€¥çŠ¶å†µæ¨¡å¼</a></li>
                  <li><a href="#æŸ¥è¯¢æ˜¯å¦å…è®¸è¯·æ±‚-ssh-å’Œ-https-åè®®çš„æµé‡">æŸ¥è¯¢æ˜¯å¦å…è®¸è¯·æ±‚ SSH å’Œ HTTPS åè®®çš„æµé‡</a></li>
                  <li><a href="#è¯·æ±‚-https-åè®®çš„æµé‡è®¾ç½®ä¸ºæ°¸ä¹…å…è®¸">è¯·æ±‚ HTTPS åè®®çš„æµé‡è®¾ç½®ä¸ºæ°¸ä¹…å…è®¸</a></li>
                  <li><a href="#è¯·æ±‚-http-åè®®çš„æµé‡è®¾ç½®ä¸ºæ°¸ä¹…æ‹’ç»">è¯·æ±‚ HTTP åè®®çš„æµé‡è®¾ç½®ä¸ºæ°¸ä¹…æ‹’ç»</a></li>
                  <li><a href="#è®¿é—®-8080-å’Œ-8081-ç«¯å£çš„æµé‡ç­–ç•¥è®¾ç½®ä¸ºå…è®¸">è®¿é—® 8080 å’Œ 8081 ç«¯å£çš„æµé‡ç­–ç•¥è®¾ç½®ä¸ºå…è®¸</a></li>
                  <li><a href="#æŠŠè®¿é—®-888-ç«¯å£çš„æµé‡è½¬å‘åˆ°-22-ç«¯å£">æŠŠè®¿é—® 888 ç«¯å£çš„æµé‡è½¬å‘åˆ° 22 ç«¯å£</a></li>
                  <li><a href="#æ‹’ç»ç½‘æ®µçš„æ‰€æœ‰ç”¨æˆ·è®¿é—®æœ¬æœºçš„-ssh-æœåŠ¡">æ‹’ç»ç½‘æ®µçš„æ‰€æœ‰ç”¨æˆ·è®¿é—®æœ¬æœºçš„ ssh æœåŠ¡</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a href="#å›¾å½¢ç®¡ç†å·¥å…·-firewall-config">å›¾å½¢ç®¡ç†å·¥å…· firewall-config</a>
            <ul>
              <li><a href="#snat">SNAT</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#æœåŠ¡çš„è®¿é—®æ§åˆ¶åˆ—è¡¨">æœåŠ¡çš„è®¿é—®æ§åˆ¶åˆ—è¡¨</a>
        <ul>
          <li><a href="#å¸¸ç”¨å‚æ•°">å¸¸ç”¨å‚æ•°</a></li>
          <li><a href="#é…ç½®åŸåˆ™">é…ç½®åŸåˆ™</a></li>
          <li><a href="#è®¿é—®æ§åˆ¶åˆ—è¡¨ç¤ºä¾‹">è®¿é—®æ§åˆ¶åˆ—è¡¨ç¤ºä¾‹</a>
            <ul>
              <li><a href="#ç¦æ­¢è®¿é—®æœ¬æœº-sshd-æœåŠ¡çš„æ‰€æœ‰æµé‡">ç¦æ­¢è®¿é—®æœ¬æœº sshd æœåŠ¡çš„æ‰€æœ‰æµé‡</a></li>
              <li><a href="#å…è®¸ç½‘æ®µè®¿é—®-sshd-æœåŠ¡">å…è®¸ç½‘æ®µè®¿é—® sshd æœåŠ¡</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#ä½¿ç”¨-ssh-æœåŠ¡ç®¡ç†è¿œç¨‹ä¸»æœº">ä½¿ç”¨ ssh æœåŠ¡ç®¡ç†è¿œç¨‹ä¸»æœº</a>
    <ul>
      <li><a href="#é…ç½®ç½‘å¡æœåŠ¡">é…ç½®ç½‘å¡æœåŠ¡</a>
        <ul>
          <li><a href="#å›¾å½¢ç•Œé¢">å›¾å½¢ç•Œé¢</a></li>
          <li><a href="#é…ç½®ç½‘å¡å‚æ•°">é…ç½®ç½‘å¡å‚æ•°</a></li>
          <li><a href="#åˆ›å»ºç½‘ç»œä¼šè¯">åˆ›å»ºç½‘ç»œä¼šè¯</a>
            <ul>
              <li><a href="#æŸ¥çœ‹ç½‘ç»œçŠ¶æ€-nmcli">æŸ¥çœ‹ç½‘ç»œçŠ¶æ€ nmcli</a></li>
              <li><a href="#ç½‘ç»œä¼šè¯åˆ‡æ¢">ç½‘ç»œä¼šè¯åˆ‡æ¢</a></li>
            </ul>
          </li>
          <li><a href="#ç»‘å®šä¸¤å—ç½‘å¡">ç»‘å®šä¸¤å—ç½‘å¡</a>
            <ul>
              <li><a href="#ç»‘å®šæ­¥éª¤">ç»‘å®šæ­¥éª¤</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#è¿œç¨‹æ§åˆ¶æœåŠ¡">è¿œç¨‹æ§åˆ¶æœåŠ¡</a>
        <ul>
          <li><a href="#é…ç½®-sshd-æœåŠ¡">é…ç½® sshd æœåŠ¡</a>
            <ul>
              <li><a href="#sshd-å‚æ•°">sshd å‚æ•°</a></li>
              <li><a href="#ç¦æ­¢ä»¥-root-èº«ä»½ç™»å½•">ç¦æ­¢ä»¥ root èº«ä»½ç™»å½•</a></li>
            </ul>
          </li>
          <li><a href="#å®‰å…¨å¯†é’¥éªŒè¯">å®‰å…¨å¯†é’¥éªŒè¯</a></li>
          <li><a href="#è¿œç¨‹ä¼ è¾“å‘½ä»¤">è¿œç¨‹ä¼ è¾“å‘½ä»¤</a>
            <ul>
              <li><a href="#scp-å‚æ•°">scp å‚æ•°</a></li>
              <li><a href="#scp-ä¼ è¾“æ–‡ä»¶">scp ä¼ è¾“æ–‡ä»¶</a></li>
              <li><a href="#scp-ä¸‹è½½æ–‡ä»¶">scp ä¸‹è½½æ–‡ä»¶</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#ä¸é—´æ–­ä¼šè¯æœåŠ¡">ä¸é—´æ–­ä¼šè¯æœåŠ¡</a></li>
      <li><a href="#selinux-å®‰å…¨å­ç³»ç»Ÿ">SELinux å®‰å…¨å­ç³»ç»Ÿ</a>
        <ul>
          <li><a href="#semange-å‘½ä»¤">semange å‘½ä»¤</a>
            <ul>
              <li><a href="#semange-å‚æ•°">semange å‚æ•°</a></li>
              <li><a href="#ç¤ºä¾‹-1">ç¤ºä¾‹</a>
                <ul>
                  <li><a href="#è®©ç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶å¯è¢«-httpd-æœåŠ¡è®¿é—®">è®©ç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶å¯è¢« httpd æœåŠ¡è®¿é—®</a></li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#ä¸ªäººç”¨æˆ·ä¸»é¡µåŠŸèƒ½">ä¸ªäººç”¨æˆ·ä¸»é¡µåŠŸèƒ½</a>
        <ul>
          <li><a href="#é…ç½®æ­¥éª¤">é…ç½®æ­¥éª¤</a></li>
          <li><a href="#ç½‘ç«™ä¸­æ·»åŠ å£ä»¤åŠŸèƒ½">ç½‘ç«™ä¸­æ·»åŠ å£ä»¤åŠŸèƒ½</a></li>
        </ul>
      </li>
      <li><a href="#è™šæ‹Ÿç½‘ç«™ä¸»æœºåŠŸèƒ½">è™šæ‹Ÿç½‘ç«™ä¸»æœºåŠŸèƒ½</a>
        <ul>
          <li><a href="#åŸºäº-ip-åœ°å€">åŸºäº IP åœ°å€</a></li>
          <li><a href="#åŸºäºä¸»æœºåŸŸå">åŸºäºä¸»æœºåŸŸå</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<!-- vim-markdown-toc -->

<h2 id="é˜²ç«å¢™">é˜²ç«å¢™</h2>

<h3 id="ç½‘ç»œé…ç½®">ç½‘ç»œé…ç½®</h3>

<p>é¦–å…ˆå‡è®¾å¦‚ä¸‹ IP åœ°å€ï¼š</p>

<ul>
  <li>ç‰©ç†çœŸæœºï¼š192.168.10.1/24</li>
  <li>æœåŠ¡å™¨ï¼š192.168.10.10/24</li>
  <li>å®¢æˆ·ç«¯ Aï¼š192.168.10.20/24</li>
  <li>å®¢æˆ·ç«¯ Bï¼š192.168.10.30/24</li>
</ul>

<blockquote>
  <p>24 è¡¨ç¤º 24 ä¸ª 1ï¼Œä¹Ÿå°±æ˜¯ 255.255.255.0
è™šæ‹Ÿæœºä¸­ï¼Œ<strong>ä»…ä¸»æœºæ¨¡å¼</strong>å¯¹åº”çš„æ˜¯<strong>vmnet1</strong>ç½‘å¡ï¼Œ<strong>NAT</strong>å¯¹åº”çš„æ˜¯<strong>vmnet8</strong>ç½‘å¡</p>
</blockquote>

<h4 id="é…ç½®è™šæ‹Ÿæœºç½‘å¡">é…ç½®è™šæ‹Ÿæœºç½‘å¡</h4>

<p>åœ¨è™šæ‹Ÿæœºä¸­é…ç½®ç½‘å¡</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> vim /etc/sysconfig/network-scripts/ifcfg-eno16777728
<span class="nv">TYPE</span><span class="o">=</span>Ethernet
<span class="c"># none è¡¨ç¤ºé»˜è®¤,è¿˜æœ‰ dhcp å’Œ static</span>
<span class="nv">BOOTPROTO</span><span class="o">=</span>none
<span class="nv">DEFROUTE</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">IPV4_FAILURE_FATAL</span><span class="o">=</span>no
<span class="nv">IPV6INIT</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">IPV6_AUTOCONF</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">IPV6_DEFROUTE</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">IPV6_FAILURE_FATAL</span><span class="o">=</span>no
<span class="nv">NAME</span><span class="o">=</span>eno16777736
<span class="nv">UUID</span><span class="o">=</span>ec77579b-2ced-481f-9c09-f562b321e268
<span class="c"># å…³é”®å‚æ•°ï¼Œé‡å¯åç½‘å¡æ˜¯å¦å¼€å¯</span>
<span class="nv">ONBOOT</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">IPADDR0</span><span class="o">=</span>192.168.10.10
<span class="nv">HWADDR</span><span class="o">=</span>00:0C:29:C4:A4:09
<span class="c">#NETMASK=255.255.255.0</span>
<span class="nv">PREFIX0</span><span class="o">=</span>24
<span class="nv">IPV6_PEERDNS</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">IPV6_PEERROUTES</span><span class="o">=</span><span class="nb">yes</span>

<span class="o">&gt;&gt;&gt;</span> systemctl restart network
</code></pre></div></div>

<h3 id="é˜²ç«å¢™ç®¡ç†å·¥å…·">é˜²ç«å¢™ç®¡ç†å·¥å…·</h3>

<p>åœ¨å…¬ç½‘ä¸å†…ç½‘ä¹‹é—´å……å½“ä¿æŠ¤å±éšœçš„é˜²ç«å¢™ä¸»è¦åŠŸèƒ½éƒ½æ˜¯ä¾æ®ç­–ç•¥å¯¹ç©¿è¶Šé˜²ç«å¢™çš„æµé‡è¿›è¡Œè¿‡æ»¤ï¼Œè‹¥æµé‡ä¸æŸä¸€æ¡ç­–ç•¥è§„åˆ™ç›¸åŒ¹é…ï¼Œåˆ™æ‰§è¡Œç›¸åº”çš„å¤„ç†ï¼Œåä¹‹åˆ™ä¸¢å¼ƒã€‚</p>

<p>åœ¨ RHEL 7 ç³»ç»Ÿä¸­ï¼Œfirewalld é˜²ç«å¢™å–ä»£äº† iptables é˜²ç«å¢™ã€‚å…¶å®ï¼Œiptables ä¸ firewalld éƒ½ä¸æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œå®ƒä»¬éƒ½åªæ˜¯ç”¨æ¥å®šä¹‰é˜²ç«å¢™ç­–ç•¥çš„é˜²ç«å¢™ç®¡ç†å·¥å…·è€Œå·²ï¼Œæˆ–è€…è¯´ï¼Œå®ƒä»¬åªæ˜¯ä¸€ç§æœåŠ¡ã€‚iptables æœåŠ¡ä¼šæŠŠé…ç½®å¥½çš„é˜²ç«å¢™ç­–ç•¥äº¤ç”±å†…æ ¸å±‚é¢çš„ netfilter ç½‘ç»œè¿‡æ»¤å™¨æ¥å¤„ç†ï¼Œè€Œ firewalld æœåŠ¡åˆ™æ˜¯æŠŠé…ç½®å¥½çš„é˜²ç«å¢™ç­–ç•¥äº¤ç”±å†…æ ¸å±‚é¢çš„ nftables åŒ…è¿‡æ»¤æ¡†æ¶æ¥å¤„ç†ã€‚æ¢å¥è¯è¯´ï¼Œå½“å‰åœ¨ Linux ç³»ç»Ÿä¸­å…¶å®å­˜åœ¨å¤šä¸ªé˜²ç«å¢™ç®¡ç†å·¥å…·ï¼Œæ—¨åœ¨æ–¹ä¾¿è¿ç»´äººå‘˜ç®¡ç† Linux ç³»ç»Ÿä¸­çš„é˜²ç«å¢™ç­–ç•¥ã€‚</p>

<h3 id="iptables">Iptables</h3>

<p>å°½ç®¡æ–°å‹çš„ firewalld é˜²ç«å¢™ç®¡ç†æœåŠ¡å·²ç»è¢«æŠ•å…¥ä½¿ç”¨å¤šå¹´ï¼Œä½†æ˜¯å¤§é‡çš„ä¼ä¸šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¾ç„¶å‡ºäºå„ç§åŸå› è€Œç»§ç»­ä½¿ç”¨ iptablesã€‚è€ƒè™‘åˆ° iptables åœ¨å½“å‰ç”Ÿäº§ç¯å¢ƒä¸­è¿˜å…·æœ‰é¡½å¼ºçš„ç”Ÿå‘½åŠ›ï¼Œè¿˜æ˜¯éœ€è¦äº†è§£ Iptables è¿™é¡¹æŠ€æœ¯ã€‚</p>

<h4 id="ç­–ç•¥ä¸è§„åˆ™é“¾">ç­–ç•¥ä¸è§„åˆ™é“¾</h4>

<p>é˜²ç«å¢™ä»ä¸Šè‡³ä¸‹è¯»å–ç­–ç•¥è§„åˆ™ï¼Œæ‰¾åˆ°åŒ¹é…é¡¹å°±å»æ‰§è¡Œå®šä¹‰çš„è¡Œä¸ºï¼ˆæ”¾è¡Œæˆ–é˜»æ­¢ï¼‰ã€‚å¦‚æœè¯»å®Œç­–ç•¥è§„åˆ™æ²¡æœ‰åŒ¹é…åˆ°ï¼Œå°±æ‰§è¡Œé»˜è®¤ç­–ç•¥ã€‚ä¸€èˆ¬é»˜è®¤{ç­–ç•¥è§„åˆ™å°±æ˜¯ä¸¤ç§ï¼š</p>

<ul>
  <li>æ”¾è¡Œ</li>
  <li>é˜»æ­¢</li>
</ul>

<p>iptables æŠŠå¤„ç†æˆ–è¿‡æ»¤æµé‡çš„ç­–ç•¥ç§°ä¸ºè§„åˆ™ï¼Œå¤šæ¡è§„åˆ™ç»„æˆä¸€ä¸ªè§„åˆ™é“¾ï¼Œæ ¹æ®æ•°æ®åŒ…å¤„ç†ä½ç½®çš„ä¸åŒï¼Œiptables çš„è§„åˆ™é“¾åˆ†ç±»å¦‚ä¸‹ï¼š</p>

<table>
  <thead>
    <tr>
      <th>ç±»åˆ«</th>
      <th>å¤„ç†ä½ç½®</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>pro-routing</td>
      <td>åœ¨è¿›è¡Œè·¯ç”±é€‰æ‹©å‰å¤„ç†æ•°æ®åŒ…</td>
    </tr>
    <tr>
      <td>input</td>
      <td>å¤„ç†æµå…¥çš„æ•°æ®åŒ…</td>
    </tr>
    <tr>
      <td>output</td>
      <td>å¤„ç†æµå‡ºçš„æ•°æ®åŒ…</td>
    </tr>
    <tr>
      <td>forward</td>
      <td>å¤„ç†è½¬å‘çš„æ•°æ®åŒ…</td>
    </tr>
    <tr>
      <td>post-routing</td>
      <td>åœ¨è¿›è¡Œè·¯ç”±é€‰æ‹©åå¤„ç†æ•°æ®åŒ…</td>
    </tr>
  </tbody>
</table>

<p>ä½¿ç”¨æœ€å¤šçš„æ˜¯ input è§„åˆ™é“¾ï¼Œä»¥é˜²å¤–ç½‘å…¥ä¾µã€‚</p>

<p>iptables é€šè¿‡ç­–ç•¥è§„åˆ™åŒ¹é…åˆ°äº†æµé‡æ•°æ®åŒ…åï¼Œè¿˜éœ€è¦æ˜ç¡®ç›¸åº”åŠ¨ä½œæ¥å¤„ç†ã€‚iptables è®¾å®šå¥½çš„åŠ¨ä½œå¦‚ä¸‹ï¼š</p>

<table>
  <thead>
    <tr>
      <th>åŠ¨ä½œ</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>accept</td>
      <td>å…è®¸æµé‡é€šè¿‡</td>
    </tr>
    <tr>
      <td>reject</td>
      <td>æ‹’ç»é€šè¿‡ï¼Œä¸¢å¼ƒåå›å¤ï¼ˆæ˜ç¡®ä¸è¦ï¼‰</td>
    </tr>
    <tr>
      <td>log</td>
      <td>è®°å½•æ—¥å¿—ä¿¡æ¯</td>
    </tr>
    <tr>
      <td>drop</td>
      <td>æ‹’ç»é€šè¿‡ï¼Œç›´æ¥ä¸¢å¼ƒä¸å“åº”ï¼ˆå‡è£…ä¸åœ¨ï¼‰</td>
    </tr>
  </tbody>
</table>

<h5 id="drop-ä¸-reject-çš„åŒºåˆ«">drop ä¸ reject çš„åŒºåˆ«</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># é˜²ç«å¢™ç­–ç•¥ä¸º REJECT</span>
<span class="o">&gt;&gt;&gt;</span> ping <span class="nt">-c</span> 4 192.168.10.10
PING 192.168.10.10 <span class="o">(</span>192.168.10.10<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
From 192.168.10.10 <span class="nv">icmp_seq</span><span class="o">=</span>1 Destination Port Unreachable
From 192.168.10.10 <span class="nv">icmp_seq</span><span class="o">=</span>2 Destination Port Unreachable
From 192.168.10.10 <span class="nv">icmp_seq</span><span class="o">=</span>3 Destination Port Unreachable
From 192.168.10.10 <span class="nv">icmp_seq</span><span class="o">=</span>4 Destination Port Unreachable
<span class="nt">---</span> 192.168.10.10 ping statistics <span class="nt">---</span>
4 packets transmitted, 0 received, +4 errors, 100% packet loss, <span class="nb">time </span>3002ms

<span class="c"># ç­–ç•¥ä¸º DROP</span>
<span class="o">&gt;&gt;&gt;</span> ping <span class="nt">-c</span> 4 192.168.10.10
PING 192.168.10.10 <span class="o">(</span>192.168.10.10<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.

<span class="nt">---</span> 192.168.10.10 ping statistics <span class="nt">---</span>
4 packets transmitted, 0 received, 100% packet loss, <span class="nb">time </span>3000ms
</code></pre></div></div>

<h4 id="åŸºæœ¬çš„å‘½ä»¤å‚æ•°">åŸºæœ¬çš„å‘½ä»¤å‚æ•°</h4>

<p>iptables æ ¹æ®æµé‡çš„<strong>æºåœ°å€ã€ç›®çš„åœ°å€ã€ä¼ è¾“åè®®ã€æœåŠ¡ç±»å‹</strong>ç­‰ä¿¡æ¯è¿›è¡ŒåŒ¹é…ã€‚åŒ¹é…æˆåŠŸåï¼Œæ ¹æ®ç­–ç•¥è§„åˆ™æ‰€é¢„è®¾çš„åŠ¨ä½œæ¥å¤„ç†è¿™äº›æµé‡ã€‚</p>

<h5 id="å¸¸ç”¨çš„å‚æ•°ä»¥åŠä½œç”¨">å¸¸ç”¨çš„å‚æ•°ä»¥åŠä½œç”¨</h5>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>ä½œç”¨</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>-P</td>
      <td>è®¾ç½®é»˜è®¤ç­–ç•¥</td>
    </tr>
    <tr>
      <td>-F</td>
      <td>æ¸…ç©ºè§„åˆ™é“¾</td>
    </tr>
    <tr>
      <td>-L</td>
      <td>æŸ¥çœ‹è§„åˆ™é“¾</td>
    </tr>
    <tr>
      <td>-A</td>
      <td>åœ¨è§„åˆ™é“¾çš„æœ«å°¾åŠ å…¥æ–°è§„åˆ™</td>
    </tr>
    <tr>
      <td>-I num</td>
      <td>åœ¨è§„åˆ™é“¾çš„å¤´éƒ¨åŠ å…¥æ–°è§„åˆ™</td>
    </tr>
    <tr>
      <td>-D num</td>
      <td>åˆ é™¤æŸä¸€æ¡è§„åˆ™</td>
    </tr>
    <tr>
      <td>-s</td>
      <td>åŒ¹é…æ¥æºåœ°å€ IP/MASKï¼ŒåŠ å¹å·â€œ!â€è¡¨ç¤ºé™¤è¿™ä¸ª IP å¤–</td>
    </tr>
    <tr>
      <td>-d</td>
      <td>åŒ¹é…ç›®æ ‡åœ°å€</td>
    </tr>
    <tr>
      <td>-i ç½‘å¡åç§°</td>
      <td>åŒ¹é…ä»è¿™å—ç½‘å¡æµå…¥çš„æ•°æ®</td>
    </tr>
    <tr>
      <td>-o ç½‘å¡åç§°</td>
      <td>åŒ¹é…ä»è¿™å—ç½‘å¡æµå‡ºçš„æ•°æ®</td>
    </tr>
    <tr>
      <td>-p</td>
      <td>åŒ¹é…åè®®ï¼Œå¦‚ TCPã€UDPã€ICMP</td>
    </tr>
    <tr>
      <td>â€“dport num</td>
      <td>åŒ¹é…ç›®æ ‡ç«¯å£å·</td>
    </tr>
    <tr>
      <td>â€“sport num</td>
      <td>åŒ¹é…æ¥æºç«¯å£å·</td>
    </tr>
  </tbody>
</table>

<h5 id="ç¤ºä¾‹">ç¤ºä¾‹</h5>

<h6 id="å‚æ•°æŸ¥çœ‹å·²æœ‰çš„é˜²ç«å¢™è§„åˆ™é“¾">å‚æ•°æŸ¥çœ‹å·²æœ‰çš„é˜²ç«å¢™è§„åˆ™é“¾</h6>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-L</span>
Chain INPUT <span class="o">(</span>policy ACCEPT<span class="o">)</span>
target prot opt <span class="nb">source </span>destination
ACCEPT all <span class="nt">--</span> anywhere anywhere ctstate RELATED,ESTABLISHED
ACCEPT all <span class="nt">--</span> anywhere anywhere
INPUT_direct all <span class="nt">--</span> anywhere anywhere
INPUT_ZONES_SOURCE all <span class="nt">--</span> anywhere anywhere
INPUT_ZONES all <span class="nt">--</span> anywhere anywhere
ACCEPT icmp <span class="nt">--</span> anywhere anywhere
REJECT all <span class="nt">--</span> anywhere anywhere reject-with icmp-host-prohibited
</code></pre></div></div>

<h6 id="æ¸…ç©ºå·²æœ‰çš„é˜²ç«å¢™è§„åˆ™é“¾">æ¸…ç©ºå·²æœ‰çš„é˜²ç«å¢™è§„åˆ™é“¾</h6>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-F</span>
<span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-L</span>
Chain INPUT <span class="o">(</span>policy ACCEPT<span class="o">)</span>
target prot opt <span class="nb">source </span>destination
... ...
</code></pre></div></div>

<h6 id="æŠŠ-input-è§„åˆ™é“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºæ‹’ç»">æŠŠ INPUT è§„åˆ™é“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºæ‹’ç»</h6>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-P</span> INPUT DROP
<span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-L</span>
Chain INPUT <span class="o">(</span>policy DROP<span class="o">)</span>
target prot opt <span class="nb">source </span>destination
... ...
</code></pre></div></div>

<blockquote>
  <p>é»˜è®¤ç­–ç•¥æ‹’ç»åŠ¨ä½œåªèƒ½æ˜¯ DROPï¼Œè€Œä¸èƒ½æ˜¯ REJECT</p>
</blockquote>

<h6 id="å‘-input-é“¾ä¸­æ·»åŠ å…è®¸-icmp-æµé‡è¿›å…¥çš„ç­–ç•¥è§„åˆ™">å‘ INPUT é“¾ä¸­æ·»åŠ å…è®¸ ICMP æµé‡è¿›å…¥çš„ç­–ç•¥è§„åˆ™</h6>

<p>è€Œå‘é˜²ç«å¢™çš„ INPUT è§„åˆ™é“¾ä¸­æ·»åŠ ä¸€æ¡å…è®¸ ICMP æµé‡è¿›å…¥çš„ç­–ç•¥è§„åˆ™å°±é»˜è®¤å…è®¸äº†è¿™ç§ ping å‘½ä»¤æ£€æµ‹è¡Œä¸ºã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-I</span> INPUT <span class="nt">-p</span> icmp <span class="nt">-j</span> ACCEPT
<span class="o">&gt;&gt;&gt;</span> ping <span class="nt">-c</span> 4 192.168.10.10
PING 192.168.10.10 <span class="o">(</span>192.168.10.10<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 192.168.10.10: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.156 ms
64 bytes from 192.168.10.10: <span class="nv">icmp_seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.117 ms
64 bytes from 192.168.10.10: <span class="nv">icmp_seq</span><span class="o">=</span>3 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.099 ms
64 bytes from 192.168.10.10: <span class="nv">icmp_seq</span><span class="o">=</span>4 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.090 ms
<span class="nt">---</span> 192.168.10.10 ping statistics <span class="nt">---</span>
4 packets transmitted, 4 received, 0% packet loss, <span class="nb">time </span>2999ms
rtt min/avg/max/mdev <span class="o">=</span> 0.090/0.115/0.156/0.027 ms
</code></pre></div></div>

<h6 id="é»˜è®¤ç­–ç•¥ä¸ºå…è®¸ä½†ä¸å…è®¸-icmp">é»˜è®¤ç­–ç•¥ä¸ºå…è®¸ï¼Œä½†ä¸å…è®¸ ICMP</h6>

<p>åˆ é™¤ INPUT ä¸­å…è®¸ ICMP æµé‡è§„åˆ™ï¼Œå¹¶æŠŠé»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºå…è®¸</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-D</span> INPUT 1
<span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-P</span> INPUT ACCEPT
<span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-L</span>
Chain INPUT <span class="o">(</span>policy ACCEPT<span class="o">)</span>
target prot opt <span class="nb">source </span>destination
... ...
</code></pre></div></div>

<h6 id="åªå…è®¸æŒ‡å®šç½‘æ®µè®¿é—®">åªå…è®¸æŒ‡å®šç½‘æ®µè®¿é—®</h6>

<p>è®¾ç½® INPUT è§„åˆ™é“¾åªå…è®¸æŒ‡å®šç½‘æ®µçš„ä¸»æœºè®¿é—®æœ¬æœºçš„ 22 ç«¯å£ï¼Œæ‹’ç»æ¥è‡ªå…¶ä»–æ‰€æœ‰ä¸»æœºçš„æµé‡ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-I</span> INPUT <span class="nt">-s</span> 192.168.10.0/24 <span class="nt">-p</span> tcp <span class="nt">--dport</span> 22 <span class="nt">-j</span> ACCEPT
<span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 22 <span class="nt">-j</span> REJECT
<span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-L</span>
Chain INPUT <span class="o">(</span>policy ACCEPT<span class="o">)</span>
target prot opt <span class="nb">source </span>destination
ACCEPT tcp <span class="nt">--</span> 192.168.10.0/24 anywhere tcp dpt:ssh
REJECT tcp <span class="nt">--</span> anywhere anywhere tcp dpt:ssh reject-with icmp-port-unreachable
... ...
</code></pre></div></div>

<blockquote>
  <p>å› ä¸ºé˜²ç«å¢™ç­–ç•¥è§„åˆ™æ˜¯æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºåŒ¹é…çš„ï¼Œæ‰€ä»¥è¦æŠŠå…è®¸åŠ¨ä½œæ”¾åˆ°æ‹’ç»åŠ¨ä½œå‰é¢ï¼Œå¦åˆ™æ‰€æœ‰çš„æµé‡å°±å°†è¢«æ‹’ç»æ‰</p>
</blockquote>

<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>

<ol>
  <li>
    <p>æŒ‡å®šç½‘æ®µè®¿é—®</p>

    <p>ä½¿ç”¨ IP åœ°å€åœ¨ 192.168.10.0/24 ç½‘æ®µå†…çš„ä¸»æœºè®¿é—®æœåŠ¡å™¨ï¼ˆå³å‰é¢æåˆ°çš„è®¾ç½®äº† INPUT è§„åˆ™é“¾çš„ä¸»æœºï¼‰çš„ 22 ç«¯å£ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> ssh 192.168.10.10
The authenticity of host <span class="s1">'192.168.10.10 (192.168.10.10)'</span> can<span class="s1">'t be established.
ECDSA key fingerprint is 70:3b:5d:37:96:7b:2e:a5:28:0d:7e:dc:47:6a:fe:5c.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span>192.168.10.10<span class="s1">' (ECDSA) to the list of known hosts.
Last login: Sun Feb 12 01:50:25 2017
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>ç½‘æ®µå¤–è®¿é—®</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> ssh 192.168.10.10
Connecting to 192.168.10.10:22...
Could not connect to <span class="s1">'192.168.10.10'</span> <span class="o">(</span>port 22<span class="o">)</span>: Connection failed.
</code></pre></div>    </div>
  </li>
</ol>

<h6 id="æ‹’ç»æ‰€æœ‰äººè®¿é—®æœ¬æœº-12345-ç«¯å£">æ‹’ç»æ‰€æœ‰äººè®¿é—®æœ¬æœº 12345 ç«¯å£</h6>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-I</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 12345 <span class="nt">-j</span> REJECT
<span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-I</span> INPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 12345 <span class="nt">-j</span> REJECT
<span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-L</span>
Chain INPUT <span class="o">(</span>policy ACCEPT<span class="o">)</span>
target prot opt <span class="nb">source </span>destination
REJECT udp <span class="nt">--</span> anywhere anywhere udp dpt:italk reject-with icmp-port-unreachable
REJECT tcp <span class="nt">--</span> anywhere anywhere tcp dpt:italk reject-with icmp-port-unreachable
ACCEPT tcp <span class="nt">--</span> 192.168.10.0/24 anywhere tcp dpt:ssh
REJECT tcp <span class="nt">--</span> anywhere anywhere tcp dpt:ssh reject-with icmp-port-unreachable
... ...
</code></pre></div></div>

<h6 id="æ‹’ç»æ‰€æœ‰ä¸»æœºè®¿é—®-10001024-ç«¯å£">æ‹’ç»æ‰€æœ‰ä¸»æœºè®¿é—® 1000~1024 ç«¯å£</h6>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 1000:1024 <span class="nt">-j</span> REJECT
<span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 1000:1024 <span class="nt">-j</span> REJECT
<span class="o">&gt;&gt;&gt;</span> iptables <span class="nt">-L</span>
Chain INPUT <span class="o">(</span>policy ACCEPT<span class="o">)</span>
target prot opt <span class="nb">source </span>destination
REJECT tcp <span class="nt">--</span> 192.168.10.5 anywhere tcp dpt:http reject-with icmp-port-unreachable
REJECT udp <span class="nt">--</span> anywhere anywhere udp dpt:italk reject-with icmp-port-unreachable
REJECT tcp <span class="nt">--</span> anywhere anywhere tcp dpt:italk reject-with icmp-port-unreachable
ACCEPT tcp <span class="nt">--</span> 192.168.10.0/24 anywhere tcp dpt:ssh
REJECT tcp <span class="nt">--</span> anywhere anywhere tcp dpt:ssh reject-with icmp-port-unreachable
REJECT tcp <span class="nt">--</span> anywhere anywhere tcp dpts:cadlock2:1024 reject-with icmp-port-unreachable
REJECT udp <span class="nt">--</span> anywhere anywhere udp dpts:cadlock2:1024 reject-with icmp-port-unreachable
... ...
</code></pre></div></div>

<h6 id="æ³¨æ„ä¿å­˜æŒ‡ä»¤">æ³¨æ„ä¿å­˜æŒ‡ä»¤</h6>

<p>ä½¿ç”¨ iptables å‘½ä»¤é…ç½®çš„é˜²ç«å¢™è§„åˆ™é»˜è®¤ä¼šåœ¨ç³»ç»Ÿä¸‹ä¸€æ¬¡é‡å¯æ—¶å¤±æ•ˆï¼Œå¦‚æœæƒ³è®©é…ç½®çš„é˜²ç«å¢™ç­–ç•¥æ°¸ä¹…ç”Ÿæ•ˆï¼Œè¿˜è¦æ‰§è¡Œä¿å­˜å‘½ä»¤</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> service iptables save
iptables: Saving firewall rules to /etc/sysconfig/iptables: <span class="o">[</span> OK <span class="o">]</span>
</code></pre></div></div>

<h3 id="firewalld">Firewalld</h3>

<p>firewalldï¼ˆDynamic Firewall Manager of Linux systemsï¼ŒLinux ç³»ç»Ÿçš„åŠ¨æ€é˜²ç«å¢™ç®¡ç†å™¨ï¼‰æœåŠ¡æ˜¯é»˜è®¤çš„é˜²ç«å¢™é…ç½®ç®¡ç†å·¥å…·ï¼Œå®ƒæ‹¥æœ‰åŸºäº CLIï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰å’ŒåŸºäº GUIï¼ˆå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼‰çš„ä¸¤ç§ç®¡ç†æ–¹å¼</p>

<p>firewalld æ”¯æŒ<strong>åŠ¨æ€æ›´æ–°æŠ€æœ¯</strong>å¹¶åŠ å…¥äº†<strong>åŒºåŸŸ</strong>ï¼ˆzoneï¼‰çš„æ¦‚å¿µã€‚ç®€å•æ¥è¯´ï¼Œfirewalld é¢„å…ˆå‡†å¤‡äº†å‡ å¥—é˜²ç«å¢™ç­–ç•¥é›†åˆï¼ˆç­–ç•¥æ¨¡æ¿ï¼‰ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®ç”Ÿäº§åœºæ™¯çš„ä¸åŒè€Œé€‰æ‹©åˆé€‚çš„ç­–ç•¥é›†åˆï¼Œä»è€Œå®ç°é˜²ç«å¢™ç­–ç•¥ä¹‹é—´çš„å¿«é€Ÿåˆ‡æ¢ã€‚</p>

<h4 id="å¸¸ç”¨çš„åŒºåŸŸåç§°åŠç­–ç•¥è§„åˆ™">å¸¸ç”¨çš„åŒºåŸŸåç§°åŠç­–ç•¥è§„åˆ™</h4>

<table>
  <thead>
    <tr>
      <th>åŒºåŸŸ</th>
      <th>é»˜è®¤è§„åˆ™ç­–ç•¥</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>trusted</td>
      <td>å…è®¸æ‰€æœ‰çš„æ•°æ®åŒ…</td>
    </tr>
    <tr>
      <td>home</td>
      <td>æ‹’ç»æµå…¥çš„æµé‡ï¼Œé™¤éä¸æµå‡ºçš„æµé‡ç›¸å…³ï¼›&lt;/br&gt;è€Œå¦‚æœæµé‡ä¸ sshã€mdnsã€ipp-clientã€amba-client ä¸ dhcpv6-client æœåŠ¡ç›¸å…³ï¼Œåˆ™å…è®¸æµé‡</td>
    </tr>
    <tr>
      <td>internal</td>
      <td>ç­‰åŒäº home åŒºåŸŸ</td>
    </tr>
    <tr>
      <td>work</td>
      <td>æ‹’ç»æµå…¥çš„æµé‡ï¼Œé™¤éä¸æµå‡ºçš„æµé‡ç›¸å…³ï¼›&lt;/br&gt;è€Œå¦‚æœæµé‡ä¸ sshã€ipp-client ä¸ dhcpv6-client æœåŠ¡ç›¸å…³ï¼Œåˆ™å…è®¸æµé‡</td>
    </tr>
    <tr>
      <td>public</td>
      <td>æ‹’ç»æµå…¥çš„æµé‡ï¼Œé™¤éä¸æµå‡ºçš„æµé‡ç›¸å…³ï¼›&lt;/br&gt;è€Œå¦‚æœæµé‡ä¸ sshã€dhcpv6-client æœåŠ¡ç›¸å…³ï¼Œåˆ™å…è®¸æµé‡</td>
    </tr>
    <tr>
      <td>external</td>
      <td>æ‹’ç»æµå…¥çš„æµé‡ï¼Œé™¤éä¸æµå‡ºçš„æµé‡ç›¸å…³ï¼›&lt;/br&gt;è€Œå¦‚æœæµé‡ä¸ ssh æœåŠ¡ç›¸å…³ï¼Œåˆ™å…è®¸æµé‡</td>
    </tr>
    <tr>
      <td>dmz</td>
      <td>æ‹’ç»æµå…¥çš„æµé‡ï¼Œé™¤éä¸æµå‡ºçš„æµé‡ç›¸å…³ï¼›&lt;/br&gt;è€Œå¦‚æœæµé‡ä¸ ssh æœåŠ¡ç›¸å…³ï¼Œåˆ™å…è®¸æµé‡</td>
    </tr>
    <tr>
      <td>block</td>
      <td>æ‹’ç»æµå…¥çš„æµé‡ï¼Œé™¤éä¸æµå‡ºçš„æµé‡ç›¸å…³</td>
    </tr>
    <tr>
      <td>drop</td>
      <td>æ‹’ç»æµå…¥çš„æµé‡ï¼Œé™¤éä¸æµå‡ºçš„æµé‡ç›¸å…³</td>
    </tr>
  </tbody>
</table>

<h4 id="ç»ˆç«¯ç®¡ç†å·¥å…·-firewall-cmd">ç»ˆç«¯ç®¡ç†å·¥å…· firewall-cmd</h4>

<p><code class="highlighter-rouge">firewall-cmd</code> æ˜¯<code class="highlighter-rouge">firewalld</code>é˜²ç«å¢™é…ç½®ç®¡ç†å·¥å…·çš„å‘½ä»¤è¡Œç‰ˆæœ¬ï¼Œå®ƒçš„å‚æ•°éƒ½æ˜¯é•¿æ ¼å¼çš„å…¨ç§°ã€‚</p>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>ä½œç”¨</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>â€“get-default-zone</td>
      <td>æŸ¥è¯¢é»˜è®¤çš„åŒºåŸŸåç§°</td>
    </tr>
    <tr>
      <td>â€“set-default-zone=<åŒºåŸŸåç§°></åŒºåŸŸåç§°></td>
      <td>è®¾ç½®é»˜è®¤çš„åŒºåŸŸï¼Œä½¿å…¶æ°¸ä¹…ç”Ÿæ•ˆ</td>
    </tr>
    <tr>
      <td>â€“get-zones</td>
      <td>æ˜¾ç¤ºå¯ç”¨çš„åŒºåŸŸ</td>
    </tr>
    <tr>
      <td>â€“get-services</td>
      <td>æ˜¾ç¤ºé¢„å…ˆå®šä¹‰çš„æœåŠ¡</td>
    </tr>
    <tr>
      <td>â€“get-active-zones</td>
      <td>æ˜¾ç¤ºå½“å‰æ­£åœ¨ä½¿ç”¨çš„åŒºåŸŸä¸ç½‘å¡åç§°</td>
    </tr>
    <tr>
      <td>â€“add-source=</td>
      <td>å°†æºè‡ªæ­¤ IP æˆ–å­ç½‘çš„æµé‡å¯¼å‘æŒ‡å®šçš„åŒºåŸŸ</td>
    </tr>
    <tr>
      <td>â€“remove-source=</td>
      <td>ä¸å†å°†æºè‡ªæ­¤ IP æˆ–å­ç½‘çš„æµé‡å¯¼å‘æŸä¸ªæŒ‡å®šåŒºåŸŸ</td>
    </tr>
    <tr>
      <td>â€“add-interface=<ç½‘å¡åç§°></ç½‘å¡åç§°></td>
      <td>å°†æºè‡ªè¯¥ç½‘å¡çš„æ‰€æœ‰æµé‡éƒ½å¯¼å‘æŸä¸ªæŒ‡å®šåŒºåŸŸ</td>
    </tr>
    <tr>
      <td>â€“change-interface=<ç½‘å¡åç§°></ç½‘å¡åç§°></td>
      <td>å°†æŸä¸ªç½‘å¡ä¸åŒºåŸŸè¿›è¡Œå…³è”</td>
    </tr>
    <tr>
      <td>â€“list-all</td>
      <td>æ˜¾ç¤ºå½“å‰åŒºåŸŸçš„ç½‘å¡é…ç½®å‚æ•°ã€èµ„æºã€ç«¯å£ä»¥åŠæœåŠ¡ç­‰ä¿¡æ¯</td>
    </tr>
    <tr>
      <td>â€“list-all-zones</td>
      <td>æ˜¾ç¤ºæ‰€æœ‰åŒºåŸŸçš„ç½‘å¡é…ç½®å‚æ•°ã€èµ„æºã€ç«¯å£ä»¥åŠæœåŠ¡ç­‰ä¿¡æ¯</td>
    </tr>
    <tr>
      <td>â€“add-service=<æœåŠ¡å></æœåŠ¡å></td>
      <td>è®¾ç½®é»˜è®¤åŒºåŸŸå…è®¸è¯¥æœåŠ¡çš„æµé‡</td>
    </tr>
    <tr>
      <td>â€“add-port=&lt;ç«¯å£å·/åè®®&gt;</td>
      <td>è®¾ç½®é»˜è®¤åŒºåŸŸå…è®¸è¯¥ç«¯å£çš„æµé‡</td>
    </tr>
    <tr>
      <td>â€“remove-service=<æœåŠ¡å></æœåŠ¡å></td>
      <td>è®¾ç½®é»˜è®¤åŒºåŸŸä¸å†å…è®¸è¯¥æœåŠ¡çš„æµé‡</td>
    </tr>
    <tr>
      <td>â€“remove-port=&lt;ç«¯å£å·/åè®®&gt;</td>
      <td>è®¾ç½®é»˜è®¤åŒºåŸŸä¸å†å…è®¸è¯¥ç«¯å£çš„æµé‡</td>
    </tr>
    <tr>
      <td>â€“reload</td>
      <td>è®©â€œæ°¸ä¹…ç”Ÿæ•ˆâ€çš„é…ç½®è§„åˆ™ç«‹å³ç”Ÿæ•ˆï¼Œå¹¶è¦†ç›–å½“å‰çš„é…ç½®è§„åˆ™</td>
    </tr>
    <tr>
      <td>â€“panic-on</td>
      <td>å¼€å¯åº”æ€¥çŠ¶å†µæ¨¡å¼</td>
    </tr>
    <tr>
      <td>â€“panic-off</td>
      <td>å…³é—­åº”æ€¥çŠ¶å†µæ¨¡å¼</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>ç”¨ firewalld é…ç½®çš„é˜²ç«å¢™ç­–ç•¥é»˜è®¤ä¸ºè¿è¡Œæ—¶ï¼ˆRuntimeï¼‰æ¨¡å¼ï¼Œéšç€ç³»ç»Ÿçš„é‡å¯ä¼šå¤±æ•ˆã€‚å¦‚æœæƒ³è®©é…ç½®ç­–ç•¥ä¸€ç›´å­˜åœ¨ï¼Œå°±éœ€è¦ä½¿ç”¨æ°¸ä¹…ï¼ˆPermanentï¼‰æ¨¡å¼äº†ï¼Œæ–¹æ³•å°±æ˜¯åœ¨ç”¨ firewall-cmd å‘½ä»¤æ­£å¸¸è®¾ç½®é˜²ç«å¢™ç­–ç•¥æ—¶æ·»åŠ â€“permanent å‚æ•°ï¼Œè¿™æ ·é…ç½®çš„é˜²ç«å¢™ç­–ç•¥å°±å¯ä»¥æ°¸ä¹…ç”Ÿæ•ˆäº†
ä½†ç”¨å®ƒè®¾ç½®çš„ç­–ç•¥åªæœ‰åœ¨ç³»ç»Ÿé‡å¯ä¹‹åæ‰èƒ½è‡ªåŠ¨ç”Ÿæ•ˆã€‚å¦‚æœæƒ³è®©é…ç½®çš„ç­–ç•¥ç«‹å³ç”Ÿæ•ˆï¼Œéœ€è¦æ‰§è¡Œ firewall-cmd â€“reload å‘½ä»¤ã€‚</p>
</blockquote>

<h5 id="å®ä¾‹">å®ä¾‹</h5>

<h6 id="æŸ¥çœ‹-firewalld-æœåŠ¡å½“å‰æ‰€ä½¿ç”¨çš„åŒºåŸŸ">æŸ¥çœ‹ firewalld æœåŠ¡å½“å‰æ‰€ä½¿ç”¨çš„åŒºåŸŸ</h6>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--get-default-zone</span>
public
</code></pre></div></div>

<h6 id="æŸ¥è¯¢ç½‘å¡åœ¨-firewalld-æœåŠ¡ä¸­çš„åŒºåŸŸ">æŸ¥è¯¢ç½‘å¡åœ¨ firewalld æœåŠ¡ä¸­çš„åŒºåŸŸ</h6>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--get-zone-of-interface</span><span class="o">=</span>eno16777728
public
</code></pre></div></div>

<h6 id="ç½‘å¡çš„é»˜è®¤åŒºåŸŸä¿®æ”¹ä¸º-external">ç½‘å¡çš„é»˜è®¤åŒºåŸŸä¿®æ”¹ä¸º external</h6>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--permanent</span> <span class="nt">--zone</span><span class="o">=</span>external <span class="nt">--change-interface</span><span class="o">=</span>eno16777728
success
<span class="c"># æŸ¥çœ‹å½“å‰ä¸æ°¸ä¹…æ¨¡å¼ä¸‹åŒºåŸŸåç§°</span>
<span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--get-zone-of-interface</span><span class="o">=</span>eno16777728
public
<span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--permanent</span> <span class="nt">--get-zone-of-interface</span><span class="o">=</span>eno16777728
external
</code></pre></div></div>

<h6 id="æŠŠ-firewalld-æœåŠ¡çš„å½“å‰é»˜è®¤åŒºåŸŸè®¾ç½®ä¸º-public">æŠŠ firewalld æœåŠ¡çš„å½“å‰é»˜è®¤åŒºåŸŸè®¾ç½®ä¸º public</h6>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--set-default-zone</span><span class="o">=</span>public
success
<span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--get-default-zone</span>
public
</code></pre></div></div>

<h6 id="å¯åŠ¨å…³é—­æ€¥çŠ¶å†µæ¨¡å¼">å¯åŠ¨/å…³é—­æ€¥çŠ¶å†µæ¨¡å¼</h6>

<p>å¯åŠ¨/å…³é—­ firewalld é˜²ç«å¢™æœåŠ¡çš„åº”æ€¥çŠ¶å†µæ¨¡å¼ï¼Œé˜»æ–­ä¸€åˆ‡ç½‘ç»œè¿æ¥ï¼ˆå½“è¿œç¨‹æ§åˆ¶æœåŠ¡å™¨æ—¶è¯·æ…ç”¨ï¼‰ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--panic-on</span>
success
<span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--panic-off</span>
success
</code></pre></div></div>

<h6 id="æŸ¥è¯¢æ˜¯å¦å…è®¸è¯·æ±‚-ssh-å’Œ-https-åè®®çš„æµé‡">æŸ¥è¯¢æ˜¯å¦å…è®¸è¯·æ±‚ SSH å’Œ HTTPS åè®®çš„æµé‡</h6>

<p>æŸ¥è¯¢ public åŒºåŸŸæ˜¯å¦å…è®¸è¯·æ±‚ SSH å’Œ HTTPS åè®®çš„æµé‡</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--query-service</span><span class="o">=</span>ssh
<span class="nb">yes</span>

<span class="o">&gt;&gt;&gt;</span> firewal-cmd <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--query-service</span><span class="o">=</span>https
no
</code></pre></div></div>

<h6 id="è¯·æ±‚-https-åè®®çš„æµé‡è®¾ç½®ä¸ºæ°¸ä¹…å…è®¸">è¯·æ±‚ HTTPS åè®®çš„æµé‡è®¾ç½®ä¸ºæ°¸ä¹…å…è®¸</h6>

<p>æŠŠ firewalld æœåŠ¡ä¸­è¯·æ±‚ HTTPS åè®®çš„æµé‡è®¾ç½®ä¸ºæ°¸ä¹…å…è®¸ï¼Œå¹¶ç«‹å³ç”Ÿæ•ˆï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--add-service</span><span class="o">=</span>https
success
<span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--permanent</span> <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--add-service</span><span class="o">=</span>https
success
<span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--reload</span>
success
</code></pre></div></div>

<h6 id="è¯·æ±‚-http-åè®®çš„æµé‡è®¾ç½®ä¸ºæ°¸ä¹…æ‹’ç»">è¯·æ±‚ HTTP åè®®çš„æµé‡è®¾ç½®ä¸ºæ°¸ä¹…æ‹’ç»</h6>

<p>æŠŠ firewalld æœåŠ¡ä¸­è¯·æ±‚ HTTP åè®®çš„æµé‡è®¾ç½®ä¸ºæ°¸ä¹…æ‹’ç»ï¼Œå¹¶ç«‹å³ç”Ÿæ•ˆï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--permanent</span> <span class="nt">--remove-service</span><span class="o">=</span>http
success
<span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--reload</span>
success
</code></pre></div></div>

<h6 id="è®¿é—®-8080-å’Œ-8081-ç«¯å£çš„æµé‡ç­–ç•¥è®¾ç½®ä¸ºå…è®¸">è®¿é—® 8080 å’Œ 8081 ç«¯å£çš„æµé‡ç­–ç•¥è®¾ç½®ä¸ºå…è®¸</h6>

<p>æŠŠåœ¨ firewalld æœåŠ¡ä¸­è®¿é—® 8080 å’Œ 8081 ç«¯å£çš„æµé‡ç­–ç•¥è®¾ç½®ä¸ºå…è®¸ï¼Œä½†ä»…é™å½“å‰ç”Ÿæ•ˆï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--add-port</span><span class="o">=</span>8080-8081/tcp
success
<span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--list-ports</span>
8080-8081/tcp
</code></pre></div></div>

<h6 id="æŠŠè®¿é—®-888-ç«¯å£çš„æµé‡è½¬å‘åˆ°-22-ç«¯å£">æŠŠè®¿é—® 888 ç«¯å£çš„æµé‡è½¬å‘åˆ° 22 ç«¯å£</h6>

<p>æŠŠåŸæœ¬è®¿é—®æœ¬æœº 888 ç«¯å£çš„æµé‡è½¬å‘åˆ° 22 ç«¯å£ï¼Œè¦ä¸”æ±‚å½“å‰å’Œé•¿æœŸå‡æœ‰æ•ˆï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--permanent</span> <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--add-forward-port</span><span class="o">=</span><span class="nv">port</span><span class="o">=</span>888:proto<span class="o">=</span>tcp:toport<span class="o">=</span>22:toaddr<span class="o">=</span>192.168.10.10
success
<span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--reload</span>
success
</code></pre></div></div>

<blockquote>
  <p>æµé‡è½¬å‘å‘½ä»¤æ ¼å¼ä¸º firewall-cmd â€“permanent â€“zone=<åŒºåŸŸ> --add-forward-port=port=<æºç«¯å£å·>:proto=<åè®®>:toport=<ç›®æ ‡ç«¯å£å·>:toaddr=<ç›®æ ‡ IP="" åœ°å€=""></ç›®æ ‡></ç›®æ ‡ç«¯å£å·></åè®®></æºç«¯å£å·></åŒºåŸŸ></p>
</blockquote>

<p>åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ ssh å‘½ä»¤å°è¯•è®¿é—® 192.168.10.10 ä¸»æœºçš„ 888 ç«¯å£ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> ssh <span class="nt">-p</span> 888 192.168.10.10
he authenticity of host <span class="s1">'[192.168.10.10]:888 ([192.168.10.10]:888)'</span> can<span class="s1">'t be established.
ECDSA key fingerprint is b8:25:88:89:5c:05:b6:dd:ef:76:63:ff:1a:54:02:1a.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span><span class="o">[</span>192.168.10.10]:888<span class="s1">' (ECDSA) to the list of known hosts.
root@192.168.10.10'</span>s password:æ­¤å¤„è¾“å…¥è¿œç¨‹rootç®¡ç†å‘˜çš„å¯†ç 
Last login: Sun Jul 19 21:43:48 2017 from 192.168.10.10
</code></pre></div></div>

<h6 id="æ‹’ç»ç½‘æ®µçš„æ‰€æœ‰ç”¨æˆ·è®¿é—®æœ¬æœºçš„-ssh-æœåŠ¡">æ‹’ç»ç½‘æ®µçš„æ‰€æœ‰ç”¨æˆ·è®¿é—®æœ¬æœºçš„ ssh æœåŠ¡</h6>

<p>å¯Œè§„åˆ™è¡¨ç¤ºæ›´ç»†è‡´ã€æ›´è¯¦ç»†çš„é˜²ç«å¢™ç­–ç•¥é…ç½®ï¼Œå®ƒå¯ä»¥é’ˆå¯¹ç³»ç»ŸæœåŠ¡ã€ç«¯å£å·ã€æºåœ°å€å’Œç›®æ ‡åœ°å€ç­‰è¯¸å¤šä¿¡æ¯è¿›è¡Œæ›´æœ‰é’ˆå¯¹æ€§çš„ç­–ç•¥é…ç½®ã€‚å®ƒçš„ä¼˜å…ˆçº§åœ¨æ‰€æœ‰çš„é˜²ç«å¢™ç­–ç•¥ä¸­ä¹Ÿæ˜¯æœ€é«˜çš„ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥åœ¨ firewalld æœåŠ¡ä¸­é…ç½®ä¸€æ¡å¯Œè§„åˆ™ï¼Œä½¿å…¶æ‹’ç» 192.168.10.0/24 ç½‘æ®µçš„æ‰€æœ‰ç”¨æˆ·è®¿é—®æœ¬æœºçš„ ssh æœåŠ¡ï¼ˆ22 ç«¯å£ï¼‰ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--permanent</span> <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--add-rich-rule</span><span class="o">=</span><span class="s2">"rule family="</span>ipv4<span class="s2">" source address="</span>192.168.10.0/24<span class="s2">" service name="</span>ssh<span class="s2">" reject"</span>
success
<span class="o">&gt;&gt;&gt;</span> firewall-cmd <span class="nt">--reload</span>
success
</code></pre></div></div>

<p>åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ ssh å‘½ä»¤å°è¯•è®¿é—® 192.168.10.10 ä¸»æœºçš„ ssh æœåŠ¡ï¼ˆ22 ç«¯å£ï¼‰ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> ssh 192.168.10.10
Connecting to 192.168.10.10:22...
Could not connect to <span class="s1">'192.168.10.10'</span> <span class="o">(</span>port 22<span class="o">)</span>: Connection failed.
</code></pre></div></div>

<h4 id="å›¾å½¢ç®¡ç†å·¥å…·-firewall-config">å›¾å½¢ç®¡ç†å·¥å…· firewall-config</h4>

<p>åœ¨ä½¿ç”¨ firewall-config å·¥å…·é…ç½®å®Œé˜²ç«å¢™ç­–ç•¥ä¹‹åï¼Œæ— é¡»è¿›è¡ŒäºŒæ¬¡ç¡®è®¤ï¼Œå› ä¸ºåªè¦æœ‰ä¿®æ”¹å†…å®¹ï¼Œå®ƒå°±è‡ªåŠ¨è¿›è¡Œä¿å­˜ã€‚</p>

<p>é…ç½®å®Œæ¯•ä¹‹åï¼Œè¿˜éœ€è¦åœ¨ Options èœå•ä¸­å•å‡» Reload Firewalld å‘½ä»¤ï¼Œè®©é…ç½®çš„é˜²ç«å¢™ç­–ç•¥ç«‹å³ç”Ÿæ•ˆã€‚ä¸å‘½ä»¤è¡Œä¸­æ‰§è¡Œâ€“reload å‚æ•°çš„æ•ˆæœä¸€æ ·ã€‚</p>

<h5 id="snat">SNAT</h5>

<p>SNATï¼ˆSource Network Address Translationï¼Œæºç½‘ç»œåœ°å€è½¬æ¢ï¼‰æŠ€æœ¯ã€‚SNAT æ˜¯ä¸€ç§ä¸ºäº†è§£å†³ IP åœ°å€åŒ®ä¹è€Œè®¾è®¡çš„æŠ€æœ¯ï¼Œå®ƒå¯ä»¥ä½¿å¾—å¤šä¸ªå†…ç½‘ä¸­çš„ç”¨æˆ·é€šè¿‡åŒä¸€ä¸ªå¤–ç½‘ IP æ¥å…¥ Internetã€‚</p>

<h3 id="æœåŠ¡çš„è®¿é—®æ§åˆ¶åˆ—è¡¨">æœåŠ¡çš„è®¿é—®æ§åˆ¶åˆ—è¡¨</h3>

<p>TCP Wrappers æ˜¯ RHEL 7 ç³»ç»Ÿä¸­é»˜è®¤å¯ç”¨çš„ä¸€æ¬¾æµé‡ç›‘æ§ç¨‹åºï¼Œå®ƒèƒ½å¤Ÿæ ¹æ®æ¥è®¿ä¸»æœºçš„åœ°å€ä¸æœ¬æœºçš„ç›®æ ‡æœåŠ¡ç¨‹åºä½œå‡ºå…è®¸æˆ–æ‹’ç»çš„æ“ä½œã€‚æ¢å¥è¯è¯´ï¼ŒLinux ç³»ç»Ÿä¸­å…¶å®æœ‰ä¸¤ä¸ªå±‚é¢çš„é˜²ç«å¢™ï¼Œç¬¬ä¸€ç§æ˜¯å‰é¢è®²åˆ°çš„åŸºäº TCP/IP åè®®çš„æµé‡è¿‡æ»¤å·¥å…·ï¼Œè€Œ TCP Wrappers æœåŠ¡åˆ™æ˜¯èƒ½å…è®¸æˆ–ç¦æ­¢ Linux ç³»ç»Ÿæä¾›æœåŠ¡çš„é˜²ç«å¢™ï¼Œä»è€Œåœ¨æ›´é«˜å±‚é¢ä¿æŠ¤äº† Linux ç³»ç»Ÿçš„å®‰å…¨è¿è¡Œã€‚</p>

<p>TCP Wrappers æœåŠ¡çš„é˜²ç«å¢™ç­–ç•¥ç”±ä¸¤ä¸ª<strong>å…è®¸</strong>å’Œ<strong>æ‹’ç»</strong>æ§åˆ¶åˆ—è¡¨æ–‡ä»¶æ‰€æ§åˆ¶ï¼Œå…è®¸æ§åˆ¶åˆ—è¡¨æ”¾è¡Œå¯¹æœåŠ¡çš„è¯·æ±‚æµé‡ï¼Œæ‹’ç»æ§åˆ¶åˆ—è¡¨é˜»æ­¢å¯¹æœåŠ¡çš„è¯·æ±‚æµé‡ã€‚</p>

<p>æ§åˆ¶åˆ—è¡¨æ–‡ä»¶ä¿®æ”¹åä¼šç«‹å³ç”Ÿæ•ˆï¼Œç³»ç»Ÿå°†ä¼šå…ˆæ£€æŸ¥å…è®¸æ§åˆ¶åˆ—è¡¨æ–‡ä»¶ï¼ˆ/etc/hosts.allowï¼‰ï¼Œå¦‚æœåŒ¹é…åˆ°ç›¸åº”çš„å…è®¸ç­–ç•¥åˆ™æ”¾è¡Œæµé‡ï¼›å¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œåˆ™å»è¿›ä¸€æ­¥åŒ¹é…æ‹’ç»æ§åˆ¶åˆ—è¡¨æ–‡ä»¶ï¼ˆ/etc/hosts.denyï¼‰ï¼Œè‹¥æ‰¾åˆ°åŒ¹é…é¡¹åˆ™æ‹’ç»è¯¥æµé‡ã€‚å¦‚æœè¿™ä¸¤ä¸ªæ–‡ä»¶å…¨éƒ½æ²¡æœ‰åŒ¹é…åˆ°ï¼Œåˆ™é»˜è®¤æ”¾è¡Œæµé‡ã€‚</p>

<h4 id="å¸¸ç”¨å‚æ•°">å¸¸ç”¨å‚æ•°</h4>

<table>
  <thead>
    <tr>
      <th>å®¢æˆ·ç«¯ç±»å‹</th>
      <th>ç¤ºä¾‹</th>
      <th>æ»¡è¶³ç¤ºä¾‹çš„å®¢æˆ·ç«¯åˆ—è¡¨</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>å•ä¸€ä¸»æœº</td>
      <td>192.168.10.10</td>
      <td>IP åœ°å€ä¸º 192.168.10.10 çš„ä¸»æœº</td>
    </tr>
    <tr>
      <td>æŒ‡å®šç½‘æ®µ</td>
      <td>192.168.10.</td>
      <td>IP æ®µä¸º 192.168.10.0/24 çš„ä¸»æœº</td>
    </tr>
    <tr>
      <td>æŒ‡å®šç½‘æ®µ</td>
      <td>192.168.10.0/255.255.255.0</td>
      <td>IP æ®µä¸º 192.168.10.0/24 çš„ä¸»æœº</td>
    </tr>
    <tr>
      <td>æŒ‡å®š DNS åç¼€</td>
      <td>.linuxprobe.com</td>
      <td>æ‰€æœ‰ DNS åç¼€ä¸º.linuxprobe.com çš„ä¸»æœº</td>
    </tr>
    <tr>
      <td>æŒ‡å®šä¸»æœºåç§°</td>
      <td>www.linuxprobe.com</td>
      <td>ä¸»æœºåç§°ä¸º www.linuxprobe.com çš„ä¸»æœº</td>
    </tr>
    <tr>
      <td>æŒ‡å®šæ‰€æœ‰å®¢æˆ·ç«¯</td>
      <td>ALL</td>
      <td>æ‰€æœ‰ä¸»æœºå…¨éƒ¨åŒ…æ‹¬åœ¨å†…</td>
    </tr>
  </tbody>
</table>

<h4 id="é…ç½®åŸåˆ™">é…ç½®åŸåˆ™</h4>

<ol>
  <li>ç¼–å†™æ‹’ç»ç­–ç•¥è§„åˆ™æ—¶ï¼Œå¡«å†™çš„æ˜¯æœåŠ¡åç§°ï¼Œè€Œéåè®®åç§°</li>
  <li>å»ºè®®å…ˆç¼–å†™æ‹’ç»ç­–ç•¥è§„åˆ™ï¼Œå†ç¼–å†™å…è®¸ç­–ç•¥è§„åˆ™ï¼Œä»¥ä¾¿ç›´è§‚åœ°çœ‹åˆ°ç›¸åº”çš„æ•ˆæœ</li>
</ol>

<h4 id="è®¿é—®æ§åˆ¶åˆ—è¡¨ç¤ºä¾‹">è®¿é—®æ§åˆ¶åˆ—è¡¨ç¤ºä¾‹</h4>

<h5 id="ç¦æ­¢è®¿é—®æœ¬æœº-sshd-æœåŠ¡çš„æ‰€æœ‰æµé‡">ç¦æ­¢è®¿é—®æœ¬æœº sshd æœåŠ¡çš„æ‰€æœ‰æµé‡</h5>

<p>ç¦æ­¢è®¿é—®æœ¬æœº sshd æœåŠ¡çš„æ‰€æœ‰æµé‡ï¼ˆæ— é¡»/etc/hosts.deny æ–‡ä»¶ä¸­ä¿®æ”¹åŸæœ‰çš„æ³¨é‡Šä¿¡æ¯ï¼‰ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> vim /etc/hosts.deny
<span class="c">#</span>
<span class="c"># hosts.deny This file contains access rules which are used to</span>
<span class="c"># deny connections to network services that either use</span>
<span class="c"># the tcp_wrappers library or that have been</span>
<span class="c"># started through a tcp_wrappers-enabled xinetd.</span>
<span class="c">#</span>
<span class="c"># The rules in this file can also be set up in</span>
<span class="c"># /etc/hosts.allow with a 'deny' option instead.</span>
<span class="c">#</span>
<span class="c"># See 'man 5 hosts_options' and 'man 5 hosts_access'</span>
<span class="c"># for information on rule syntax.</span>
<span class="c"># See 'man tcpd' for information on tcp_wrappers</span>
sshd:<span class="k">*</span>

<span class="o">&gt;&gt;&gt;</span> ssh 192.168.10.10
ssh_exchange_identification: <span class="nb">read</span>: Connection reset by peer
</code></pre></div></div>

<h5 id="å…è®¸ç½‘æ®µè®¿é—®-sshd-æœåŠ¡">å…è®¸ç½‘æ®µè®¿é—® sshd æœåŠ¡</h5>

<p>åœ¨å…è®¸ç­–ç•¥è§„åˆ™æ–‡ä»¶ä¸­æ·»åŠ ä¸€æ¡è§„åˆ™ï¼Œä½¿å…¶æ”¾è¡Œæºè‡ª 192.168.10.0/24 ç½‘æ®µï¼Œè®¿é—®æœ¬æœº sshd æœåŠ¡çš„æ‰€æœ‰æµé‡ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> vim /etc/host.allow
<span class="c">#</span>
<span class="c"># hosts.allow This file contains access rules which are used to</span>
<span class="c"># allow or deny connections to network services that</span>
<span class="c"># either use the tcp_wrappers library or that have been</span>
<span class="c"># started through a tcp_wrappers-enabled xinetd.</span>
<span class="c">#</span>
<span class="c"># See 'man 5 hosts_options' and 'man 5 hosts_access'</span>
<span class="c"># for information on rule syntax.</span>
<span class="c"># See 'man tcpd' for information on tcp_wrappers</span>
sshd:192.168.10.

<span class="o">&gt;&gt;&gt;</span> ssh 192.168.10.10
The authenticity of host <span class="s1">'192.168.10.10 (192.168.10.10)'</span> can<span class="s1">'t be established.
ECDSA key fingerprint is 70:3b:5d:37:96:7b:2e:a5:28:0d:7e:dc:47:6a:fe:5c.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span>192.168.10.10<span class="s1">' (ECDSA) to the list of known hosts.
root@192.168.10.10'</span>s password:
Last login: Wed May 4 07:56:29 2017
</code></pre></div></div>

<h2 id="ä½¿ç”¨-ssh-æœåŠ¡ç®¡ç†è¿œç¨‹ä¸»æœº">ä½¿ç”¨ ssh æœåŠ¡ç®¡ç†è¿œç¨‹ä¸»æœº</h2>

<p>æœ¬ç« è®°å½• nmtui å‘½ä»¤å’Œ nmcli å‘½ä»¤ï¼›äº†è§£ç»‘å®šåŒç½‘å¡ï¼Œå®ç°ç½‘ç»œè´Ÿè½½å‡è¡¡ã€‚è¿˜è®°å½•äº† SSH åè®®ä¸ sshd æœåŠ¡ç¨‹åº</p>

<h3 id="é…ç½®ç½‘å¡æœåŠ¡">é…ç½®ç½‘å¡æœåŠ¡</h3>

<h4 id="å›¾å½¢ç•Œé¢">å›¾å½¢ç•Œé¢</h4>

<p>å›¾å½¢ç•Œé¢æœ‰ mntui å’Œ nm-connection-editor ä¸¤æ¬¾ã€‚æ³¨æ„ï¼Œåœ¨ RHEL7 ä¸­ï¼Œç½‘å¡åç§°ä¸º eno1234</p>

<h4 id="é…ç½®ç½‘å¡å‚æ•°">é…ç½®ç½‘å¡å‚æ•°</h4>

<p>é€šè¿‡å‘½ä»¤è¡Œæ¥é…ç½®ç½‘å¡å‚æ•°ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>

<ol>
  <li>
    <p>è®¾ç½®å¥½ç½‘å¡</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> vim /etc/sysconfig/network-scripts/ifcfg-eno16777736
<span class="nv">TYPE</span><span class="o">=</span>Ethernet
<span class="c"># none è¡¨ç¤ºé»˜è®¤,è¿˜æœ‰ dhcp å’Œ static</span>
<span class="nv">BOOTPROTO</span><span class="o">=</span>none
<span class="nv">DEFROUTE</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">IPV4_FAILURE_FATAL</span><span class="o">=</span>no
<span class="nv">IPV6INIT</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">IPV6_AUTOCONF</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">IPV6_DEFROUTE</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">IPV6_FAILURE_FATAL</span><span class="o">=</span>no
<span class="nv">NAME</span><span class="o">=</span>eno16777736
<span class="nv">UUID</span><span class="o">=</span>ec77579b-2ced-481f-9c09-f562b321e268
<span class="c"># å…³é”®å‚æ•°</span>
<span class="nv">ONBOOT</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">IPADDR0</span><span class="o">=</span>192.168.10.10
<span class="nv">HWADDR</span><span class="o">=</span>00:0C:29:C4:A4:09
<span class="c">#NETMASK=255.255.255.0</span>
<span class="nv">PREFIX0</span><span class="o">=</span>24
<span class="nv">IPV6_PEERDNS</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">IPV6_PEERROUTES</span><span class="o">=</span><span class="nb">yes</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>é‡å¯ç½‘å¡æœåŠ¡</p>
  </li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> systemctl restart network
<span class="o">&gt;&gt;&gt;</span> ping <span class="nt">-c</span> 4 192.168.10.10
PING 192.168.10.10 <span class="o">(</span>192.168.10.10<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 192.168.10.10: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.056 ms
64 bytes from 192.168.10.10: <span class="nv">icmp_seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.099 ms
64 bytes from 192.168.10.10: <span class="nv">icmp_seq</span><span class="o">=</span>3 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.095 ms
64 bytes from 192.168.10.10: <span class="nv">icmp_seq</span><span class="o">=</span>4 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.095 ms

<span class="nt">---</span> 192.168.10.10 ping statistics <span class="nt">---</span>
4 packets transmitted, 4 received, 0% packet loss, <span class="nb">time </span>2999ms
rtt min/avg/max/mdev <span class="o">=</span> 0.056/0.086/0.099/0.018 ms
</code></pre></div></div>

<h4 id="åˆ›å»ºç½‘ç»œä¼šè¯">åˆ›å»ºç½‘ç»œä¼šè¯</h4>

<p>RHEL7 ç”¨ NetworkManager æä¾›ç½‘ç»œæœåŠ¡ï¼Œå®ƒæ˜¯ä¸€ç§åŠ¨æ€ç®¡ç†ç½‘ç»œé…ç½®çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œèƒ½è®©ç½‘ç»œè®¾å¤‡ä¿æŒè¿æ¥çŠ¶æ€ã€‚å¯ä»¥ä½¿ç”¨ nmcli æ¥ç®¡ç† NetworkManager æœåŠ¡ã€‚</p>

<h5 id="æŸ¥çœ‹ç½‘ç»œçŠ¶æ€-nmcli">æŸ¥çœ‹ç½‘ç»œçŠ¶æ€ nmcli</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> nmcli connection show
NAME UUID TYPE DEVICE
eno16777736 ec77579b-2ced-481f&lt;Plug&gt;<span class="o">(</span>StopHL<span class="o">)</span><span class="nt">-9c09-f562b321e268</span> 802-3-ethernet eno16777736

<span class="o">&gt;&gt;&gt;</span> nmcli con show eno16777736
connection.id: eno16777736
connection.uuid: ec77579b-2ced-481f-9c09-f562b321e268
connection.interface-name: <span class="nt">--</span>
connection.type: 802-3-ethernet
connection.autoconnect: <span class="nb">yes
</span>connection.timestamp: 1487348994
... ...
</code></pre></div></div>

<h5 id="ç½‘ç»œä¼šè¯åˆ‡æ¢">ç½‘ç»œä¼šè¯åˆ‡æ¢</h5>

<p>ç”¨æˆ·å¯ä»¥åœ¨å¤šä¸ªé…ç½®æ–‡ä»¶ä¸­åˆ‡æ¢ã€‚æ¯”å¦‚åœ¨å…¬å¸éœ€è¦ç”¨æ‰‹åŠ¨æŒ‡å®šçš„ç½‘ç»œ IP åœ°å€ï¼Œè€Œåœ¨å®¶ä¸­è¦åˆ‡æ¢åˆ° DHCP è‡ªåŠ¨åˆ†é… IP åœ°å€ï¼Œè¿™å°±å¯ä»¥ä½¿ç”¨ç½‘ç»œä¼šè¯åŠŸèƒ½ã€‚åªéœ€è¦åœ¨ä¸åŒçš„ç¯å¢ƒä¸­æ¿€æ´»ç›¸åº”çš„ç½‘ç»œä¼šè¯ï¼Œå°±å¯ä»¥å®ç°ç½‘ç»œé…ç½®çš„è‡ªåŠ¨åˆ‡æ¢ã€‚</p>

<p>å‡è®¾å…¬å¸ç¯å¢ƒçš„ä¼šè¯ä¸º companyï¼Œå®¶åº­ç½‘ç»œä¼šè¯ä¸º houseï¼Œåˆ›å»ºè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>

<ol>
  <li>
    <p>æŒ‡å®šå…¬å¸æ‰€ç”¨ç½‘ç»œä¼šè¯ä¸º company</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> nmcli connection add con-name company ifname eno16777736 <span class="se">\</span>
autoconnect no <span class="nb">type </span>ethernet ip4 192.168.10.10/24 gw4 192.168.10.1
Connection <span class="s1">'company'</span> <span class="o">(</span>86c71220-0057-419e-b615-38f4014cfdee<span class="o">)</span> successfully added.
</code></pre></div>    </div>

    <blockquote>
      <p>è¯´æ˜ï¼š
con-nameï¼šæŒ‡å®šå…¬å¸æ‰€ç”¨ç½‘ç»œä¼šè¯ä¸º company
ifnameï¼šæŒ‡å®šæœ¬æœºç½‘å¡åç§°
autoconnect noï¼šç½‘ç»œä¼šè¯ä¸ä¼šè‡ªåŠ¨æ¿€æ´»
ip4 å’Œ gw4ï¼šæ‰‹åŠ¨æŒ‡å®šç½‘ç»œ IP åœ°å€</p>
    </blockquote>
  </li>
  <li>
    <p>æŒ‡å®šå®¶åº­ç½‘ç»œä¼šè¯ä¸º house</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> nmcli connection add con-name house <span class="nb">type </span>ethernet ifname eno16777736
Connection <span class="s1">'house'</span> <span class="o">(</span>44acf0a7-07e2-40b4-94ba-69ea973090fb<span class="o">)</span> successfully added.
</code></pre></div>    </div>
  </li>
  <li>
    <p>æŸ¥çœ‹ç½‘ç»œä¼šè¯</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> nmcli connection show
NAME UUID TYPE DEVICE
house        44acf0a7-07e2-40b4-94ba-69ea973090fb 802-3-ethernet <span class="nt">--</span>
company      86c71220-0057-419e-b615-38f4014cfdee 802-3-ethernet <span class="nt">--</span>
eno16777736  ec77579b-2ced-481f-9c09-f562b321e268 802-3-ethernet eno16777736
</code></pre></div>    </div>
  </li>
  <li>
    <p>åˆ‡æ¢ä¼šè¯</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> nmcli connection up house
Connection successfully activated <span class="o">(</span>D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/2<span class="o">)</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="ç»‘å®šä¸¤å—ç½‘å¡">ç»‘å®šä¸¤å—ç½‘å¡</h4>

<p>ç½‘å¡ç»‘å®šå¯ä»¥æé«˜ç½‘ç»œä¼ è¾“é€Ÿåº¦ï¼Œè¿˜å¯ä»¥ç¡®ä¿åœ¨ä¸€åœºç½‘å¡æ•…éšœæ—¶ï¼Œä¾ç„¶å¯ä»¥æ­£å¸¸è¿ç½‘ã€‚æˆ‘ä»¬ç»‘å®šç½‘å¡çš„è¯ï¼Œå®ƒä»¬ä¼šå…±åŒä¼ è¾“æ•°æ®ï¼Œæå‡ç½‘é€Ÿä¹Ÿå¯ä»¥é¿å…ç½‘ç»œä¸­æ–­ã€‚</p>

<h5 id="ç»‘å®šæ­¥éª¤">ç»‘å®šæ­¥éª¤</h5>

<ol>
  <li>
    <p>ç¡®ä¿ä¸¤å—ç½‘å¡æ˜¯åŒä¸€ç½‘ç»œæ¨¡å¼</p>

    <p>å¤„äºç›¸åŒæ¨¡å¼çš„ç½‘å¡è®¾å¤‡æ‰å¯ä»¥è¿›è¡Œç»‘å®šï¼Œç›¸äº’ä¼ é€æ•°æ®</p>
  </li>
  <li>
    <p>é…ç½®ç½‘å¡å‚æ•°</p>

    <p>æŠŠä¸¤å—ç‹¬ç«‹çš„ç½‘å¡é…ç½®æˆä¸€å—ä»å±ç½‘å¡ï¼ŒæœåŠ¡äºä¸»ç½‘å¡ï¼Œä¸åº”è¯¥æœ‰è‡ªå·±çš„ IP åœ°å€</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> vim /etc/sysconfig/network-scripts/ifcfg-eno16777736
<span class="nv">TYPE</span><span class="o">=</span>Ethernet
<span class="nv">BOOTPROTO</span><span class="o">=</span>none
<span class="nv">ONBOOT</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">USERCTL</span><span class="o">=</span>no
<span class="nv">DEVICE</span><span class="o">=</span>eno16777736
<span class="c"># ç»‘å®šåçš„è®¾å¤‡å…¨åä¸ºbond0</span>
<span class="nv">MASTER</span><span class="o">=</span>bond0
<span class="c"># ä½œä¸ºä»å±ç½‘å¡</span>
<span class="nv">SLAVE</span><span class="o">=</span><span class="nb">yes</span>

<span class="o">&gt;&gt;&gt;</span> vim /etc/sysconfig/network-scripts/ifcfg-eno33554968
<span class="nv">TYPE</span><span class="o">=</span>Ethernet
<span class="nv">BOOTPROTO</span><span class="o">=</span>none
<span class="nv">ONBOOT</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">USERCTL</span><span class="o">=</span>no
<span class="nv">DEVICE</span><span class="o">=</span>eno33554968
<span class="nv">MASTER</span><span class="o">=</span>bond0
<span class="nv">SLAVE</span><span class="o">=</span><span class="nb">yes</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>é…ç½®ç»‘å®šç½‘å¡çš„å‚æ•°</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> vim /etc/sysconfig/network-scripts/ifcfg-bond0
<span class="nv">TYPE</span><span class="o">=</span>Ethernet
<span class="nv">BOOTPROTO</span><span class="o">=</span>none
<span class="nv">ONBOOT</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">USERCTL</span><span class="o">=</span>no
<span class="nv">DEVICE</span><span class="o">=</span>bond0
<span class="nv">IPADDR</span><span class="o">=</span>192.168.10.10
<span class="nv">PREFIX</span><span class="o">=</span>24
<span class="nv">DNS</span><span class="o">=</span>192.168.10.1
<span class="nv">NM_CONTROLLED</span><span class="o">=</span>no
</code></pre></div>    </div>
  </li>
  <li>
    <p>è®© Linux å†…æ ¸æ”¯æŒç½‘å¡ç»‘å®šé©±åŠ¨</p>

    <p>å¸¸è§çš„ç½‘å¡ç»‘å®šé©±åŠ¨æœ‰ä¸‰ç§ï¼šmode0ã€mode1 å’Œ mode6ï¼Œå…¶ä¸­ï¼š</p>

    <ul>
      <li>mode0ï¼šå¹³è¡¡è´Ÿè½½æ¨¡å¼
ä¸¤å—ç½‘å¡å‡å·¥ä½œï¼Œä¸”è‡ªåŠ¨å¤‡æ´ï¼Œä½†éœ€è¦åœ¨ä¸æœåŠ¡å™¨æœ¬åœ°ç½‘å¡ç›¸è¿çš„äº¤æ¢æœºè®¾å¤‡ä¸Šè¿›è¡Œç«¯å£èšåˆæ¥æ”¯æŒç»‘å®šæŠ€æœ¯ã€‚</li>
      <li>mode1ï¼šè‡ªåŠ¨å¤‡æ´æ¨¡å¼
ä¸€å—ç½‘å¡å·¥ä½œï¼Œå¦ä¸€å—ä½œçƒ­å¤‡</li>
      <li>mode6ï¼šå¹³è¡¡è´Ÿè½½æ¨¡å¼
æ—¶ä¸¤å—ç½‘å¡å‡å·¥ä½œï¼Œä¸”è‡ªåŠ¨å¤‡æ´ï¼Œæ— é¡»äº¤æ¢æœºè®¾å¤‡æä¾›è¾…åŠ©æ”¯æŒ</li>
    </ul>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">&gt;&gt;&gt;</span> nvim /etc/modprobe.d/bond.conf
 <span class="c"># ä½¿ bond0 ç½‘å¡èƒ½æ”¯æŒç»‘å®šæŠ€æœ¯(bonding)</span>
 <span class="nb">alias </span>bond0 bonding
 <span class="c"># ä»¥mode6æ¨¡å¼ç»‘å®šï¼Œæ•…éšœåˆ‡æ¢æ—¶é—´100ms</span>
 options bond0 <span class="nv">miimon</span><span class="o">=</span>100 <span class="nv">mode</span><span class="o">=</span>6
</code></pre></div>    </div>
  </li>
  <li>
    <p>é‡å¯ç½‘ç»œæœåŠ¡</p>

    <p>åªæœ‰ bond0 ç½‘å¡æ‰ä¼šæœ‰ IP åœ°å€</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> systemctl restart network
<span class="o">&gt;&gt;&gt;</span> ifconfig
bond0: <span class="nv">flags</span><span class="o">=</span>5187&lt;UP,BROADCAST,RUNNING,MASTER,MULTICAST&gt; mtu 1500
inet 192.168.10.10 netmask 255.255.255.0 broadcast 192.168.10.255
inet6 fe80::20c:29ff:fe9c:637d prefixlen 64 scopeid 0x20&lt;<span class="nb">link</span><span class="o">&gt;</span>
ether 00:0c:29:9c:63:7d txqueuelen 0 <span class="o">(</span>Ethernet<span class="o">)</span>
RX packets 700 bytes 82899 <span class="o">(</span>80.9 KiB<span class="o">)</span>
RX errors 0 dropped 6 overruns 0 frame 0
TX packets 588 bytes 40260 <span class="o">(</span>39.3 KiB<span class="o">)</span>
TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0

eno16777736: <span class="nv">flags</span><span class="o">=</span>6211&lt;UP,BROADCAST,RUNNING,SLAVE,MULTICAST&gt; mtu 1500
ether 00:0c:29:9c:63:73 txqueuelen 1000 <span class="o">(</span>Ethernet<span class="o">)</span>
RX packets 347 bytes 40112 <span class="o">(</span>39.1 KiB<span class="o">)</span>
RX errors 0 dropped 6 overruns 0 frame 0
TX packets 263 bytes 20682 <span class="o">(</span>20.1 KiB<span class="o">)</span>
TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0

eno33554968: <span class="nv">flags</span><span class="o">=</span>6211&lt;UP,BROADCAST,RUNNING,SLAVE,MULTICAST&gt; mtu 1500
ether 00:0c:29:9c:63:7d txqueuelen 1000 <span class="o">(</span>Ethernet<span class="o">)</span>
RX packets 353 bytes 42787 <span class="o">(</span>41.7 KiB<span class="o">)</span>
RX errors 0 dropped 0 overruns 0 frame 0
TX packets 325 bytes 19578 <span class="o">(</span>19.1 KiB<span class="o">)</span>
TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0
</code></pre></div>    </div>

    <p>å½“æˆ‘ä»¬æ‹”å‡ºä¸€å—ç½‘å¡æ—¶ï¼Œå¯ä»¥çœ‹åˆ°ç½‘å¡åˆ‡æ¢è¿‡ç¨‹</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> ping 192.168.10.10
ping 192.168.10.10
PING 192.168.10.10 <span class="o">(</span>192.168.10.10<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 192.168.10.10: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.109 ms
64 bytes from 192.168.10.10: <span class="nv">icmp_seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.102 ms
64 bytes from 192.168.10.10: <span class="nv">icmp_seq</span><span class="o">=</span>3 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.066 ms
ping: sendmsg: Network is unreachable
64 bytes from 192.168.10.10: <span class="nv">icmp_seq</span><span class="o">=</span>5 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.065 ms
64 bytes from 192.168.10.10: <span class="nv">icmp_seq</span><span class="o">=</span>6 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.048 ms
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="è¿œç¨‹æ§åˆ¶æœåŠ¡">è¿œç¨‹æ§åˆ¶æœåŠ¡</h3>

<h4 id="é…ç½®-sshd-æœåŠ¡">é…ç½® sshd æœåŠ¡</h4>

<p>SSH (Secure Shell) æ˜¯ä¸€ç§ä»¥å®‰å…¨æ–¹å¼æä¾›è¿œç¨‹ç™»å½•çš„åè®®ã€‚ä¹‹å‰é‡‡ç”¨çš„æ˜¯ FTP æˆ– Telnet ç™»å½•ï¼Œä½†å®ƒä»¬ä»¥æ˜æ–‡å½¢å¼ä¼ è¾“å¸æˆ·å’Œå¯†ç ï¼Œå¾ˆä¸å®‰å…¨ã€‚</p>

<p>æˆ‘ä»¬éœ€è¦å…ˆéƒ¨ç½² sshd æœåŠ¡ï¼Œå®ƒæ˜¯ä¸€æ¬¾è¿œç¨‹ç®¡ç†æœåŠ¡ç¨‹åºï¼Œæœ‰ä¸¤ç§å®‰å…¨çš„éªŒè¯æ–¹æ³•ï¼š</p>

<ol>
  <li>åŸºäºå£ä»¤çš„éªŒè¯</li>
  <li>
    <p>åŸºäºå¯†é’¥çš„éªŒè¯</p>

    <p>è¦åœ¨æœ¬åœ°ç”Ÿæˆå¯†é’¥å¯¹ï¼ŒæŠŠå…¬é’¥ä¸Šä¼ è‡³æœåŠ¡å™¨ã€‚</p>
  </li>
</ol>

<p>sshd æœåŠ¡çš„é…ç½®ä¿¡æ¯ä¿å­˜åœ¨ <code class="highlighter-rouge">/etc/ssh/sshd_config</code> ä¸­ã€‚æˆ‘ä»¬æŠŠä¿å­˜çš„æœ€ä¸»è¦é…ç½®ä¿¡æ¯çš„æ–‡ä»¶ç§°ä¸º<strong>ä¸»é…ç½®æ–‡ä»¶</strong>ï¼Œssh æœåŠ¡é…ç½®æ–‡ä»¶çš„ä¸»è¦å‚æ•°å¦‚ä¸‹ï¼š</p>

<h5 id="sshd-å‚æ•°">sshd å‚æ•°</h5>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>ä½œç”¨</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">Port 22</code></td>
      <td>é»˜è®¤çš„ sshd æœåŠ¡ç«¯å£</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ListenAddress 0.0.0.0</code></td>
      <td>è®¾å®š sshd æœåŠ¡å™¨ç›‘å¬çš„ IP åœ°å€</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Protocol 2</code></td>
      <td>SSH åè®®çš„ç‰ˆæœ¬å·</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">HostKey /tc/ssh/ssh_host_key</code></td>
      <td>SSH åè®®ç‰ˆæœ¬ä¸º 1 æ—¶ï¼ŒDES ç§é’¥å­˜æ”¾çš„ä½ç½®</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">HostKey /etc/ssh/ssh_host_rsa_key</code></td>
      <td>SSH åè®®ç‰ˆæœ¬ä¸º 2 æ—¶ï¼ŒRSA ç§é’¥å­˜æ”¾çš„ä½ç½®</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">HostKey /etc/ssh/ssh_host_dsa_key</code></td>
      <td>SSH åè®®ç‰ˆæœ¬ä¸º 2 æ—¶ï¼ŒDSA ç§é’¥å­˜æ”¾çš„ä½ç½®</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">PermitRootLogin yes</code></td>
      <td>è®¾å®šæ˜¯å¦å…è®¸ root ç®¡ç†å‘˜ç›´æ¥ç™»å½•</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">StrictModes yes</code></td>
      <td>å½“è¿œç¨‹ç”¨æˆ·çš„ç§é’¥æ”¹å˜æ—¶ç›´æ¥æ‹’ç»è¿æ¥</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">MaxAuthTries 6</code></td>
      <td>æœ€å¤§å¯†ç å°è¯•æ¬¡æ•°</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">MaxSessions 10</code></td>
      <td>æœ€å¤§ç»ˆç«¯æ•°</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">PasswordAuthentication yes</code></td>
      <td>æ˜¯å¦å…è®¸å¯†ç éªŒè¯</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">PermitEmptyPasswords no</code></td>
      <td>æ˜¯å¦å…è®¸ç©ºå¯†ç ç™»å½•ï¼ˆå¾ˆä¸å®‰å…¨ï¼‰</td>
    </tr>
  </tbody>
</table>

<h5 id="ç¦æ­¢ä»¥-root-èº«ä»½ç™»å½•">ç¦æ­¢ä»¥ root èº«ä»½ç™»å½•</h5>

<ol>
  <li>
    <p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> vim /etc/ssh/sshd_config
â€¦â€¦â€¦â€¦â€¦â€¦çœç•¥éƒ¨åˆ†è¾“å‡ºä¿¡æ¯â€¦â€¦â€¦â€¦â€¦â€¦
46
47 <span class="c">#LoginGraceTime 2m</span>
<span class="c"># æŠŠæ­¤è¡Œæ”¹ä¸º no</span>
48 PermitRootLogin no
49 <span class="c">#StrictModes yes</span>
50 <span class="c">#MaxAuthTries 6</span>
51 <span class="c">#MaxSessions 10</span>
52
â€¦â€¦â€¦â€¦â€¦â€¦çœç•¥éƒ¨åˆ†è¾“å‡ºä¿¡æ¯â€¦â€¦â€¦â€¦â€¦â€¦
</code></pre></div>    </div>
  </li>
  <li>
    <p>é‡å¯æœåŠ¡ç¨‹åº</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> systemctl restart sshd
<span class="o">&gt;&gt;&gt;</span> systemctl <span class="nb">enable </span>sshd
</code></pre></div>    </div>
  </li>
  <li>
    <p>å†ä»¥ root èº«ä»½ç™»å½•</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> ssh 192.168.10.10
root@192.168.10.10<span class="s1">'s password:æ­¤å¤„è¾“å…¥è¿œç¨‹ä¸»æœºrootç”¨æˆ·çš„å¯†ç 
Permission denied, please try again.
</span></code></pre></div>    </div>
  </li>
</ol>

<h4 id="å®‰å…¨å¯†é’¥éªŒè¯">å®‰å…¨å¯†é’¥éªŒè¯</h4>

<p>å¯†é’¥åˆ†æˆç§é’¥å’Œå…¬é’¥ã€‚åœ¨ä¼ è¾“å‰å…ˆä½¿ç”¨å…¬é’¥å¯¹æ•°æ®åŠ å¯†ï¼Œç„¶åå†ä¼ è¾“ã€‚åªæœ‰æŒæ¡ç§é’¥çš„ç”¨æˆ·æ‰èƒ½è§£å¯†è¿™æ®µæ•°æ®ã€‚å…·æœ‰è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>

<ol>
  <li>
    <p>åœ¨å®¢æˆ·ç«¯ç”Ÿæˆå¯†é’¥å¯¹</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> ssh-keygen
Generating public/private rsa key pair.
Enter file <span class="k">in </span>which to save the key <span class="o">(</span>/root/.ssh/id_rsa<span class="o">)</span>:æŒ‰å›è½¦é”®æˆ–è®¾ç½®å¯†é’¥çš„å­˜å‚¨è·¯å¾„
Created directory <span class="s1">'/root/.ssh'</span><span class="nb">.</span>
Enter passphrase <span class="o">(</span>empty <span class="k">for </span>no passphrase<span class="o">)</span>:ç›´æ¥æŒ‰å›è½¦é”®æˆ–è®¾ç½®å¯†é’¥çš„å¯†ç 
Enter same passphrase again:å†æ¬¡æŒ‰å›è½¦é”®æˆ–è®¾ç½®å¯†é’¥çš„å¯†ç 
Your identification has been saved <span class="k">in</span> /root/.ssh/id_rsa.
Your public key has been saved <span class="k">in</span> /root/.ssh/id_rsa.pub.
... ...
</code></pre></div>    </div>
  </li>
  <li>
    <p>æŠŠå…¬é’¥ä¼ é€è‡³è¿œç¨‹ä¸»æœº</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> ssh-copy-id 192.168.10.10
The authenticity of host <span class="s1">'192.168.10.20 (192.168.10.10)'</span> can<span class="s1">'t be established.
ECDSA key fingerprint is 4f:a7:91:9e:8d:6f:b9:48:02:32:61:95:48:ed:1e:3f.
Are you sure you want to continue connecting (yes/no)? yes
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@192.168.10.10'</span>s password:æ­¤å¤„è¾“å…¥è¿œç¨‹æœåŠ¡å™¨å¯†ç 
Number of key<span class="o">(</span>s<span class="o">)</span> added: 1
Now try logging into the machine, with: <span class="s2">"ssh '192.168.10.10'"</span>
and check to make sure that only the key<span class="o">(</span>s<span class="o">)</span> you wanted were added.
</code></pre></div>    </div>
  </li>
  <li>
    <p>è®¾ç½®æœåŠ¡å™¨åªå…è®¸å¯†é’¥éªŒè¯ï¼Œæ‹’ç»å£ä»¤éªŒè¯</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> vim /etc/ssh/sshd_config
74
75 <span class="c"># To disable tunneled clear text passwords, change to no here!</span>
76 <span class="c">#PasswordAuthentication yes</span>
77 <span class="c">#PermitEmptyPasswords no</span>
78 PasswordAuthentication no
79

<span class="o">&gt;&gt;&gt;</span> systemctl restart ssh
</code></pre></div>    </div>
  </li>
  <li>
    <p>åœ¨å®¢æˆ·ç«¯ç™»å½•</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> ssh 192.168.10.10
Last login: Mon Apr 13 19:34:13 2017
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="è¿œç¨‹ä¼ è¾“å‘½ä»¤">è¿œç¨‹ä¼ è¾“å‘½ä»¤</h4>

<p>scp (secure copy) æ˜¯åŸºäº ssh åè®®çš„ä¼ è¾“å‘½ä»¤ï¼Œæ ¼å¼ä¸º <code class="highlighter-rouge">scp [å‚æ•°] æœ¬åœ°æ–‡ä»¶ è¿œç¨‹è´¦æˆ·@è¿œç¨‹IPåœ°å€:è¿œç¨‹ç›®å½•</code></p>

<h5 id="scp-å‚æ•°">scp å‚æ•°</h5>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>ä½œç”¨</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>-v</td>
      <td>æ˜¾ç¤ºè¯¦ç»†çš„è¿æ¥è¿›åº¦</td>
    </tr>
    <tr>
      <td>-P</td>
      <td>æŒ‡å®šè¿œç¨‹ä¸»æœºçš„ sshd ç«¯å£å·</td>
    </tr>
    <tr>
      <td>-r</td>
      <td>ç”¨äºä¼ é€æ–‡ä»¶å¤¹</td>
    </tr>
    <tr>
      <td>-6</td>
      <td>ä½¿ç”¨ IPv6 åè®®</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>æ³¨æ„ï¼š
scp æœ¬åœ°æ–‡ä»¶çš„ä½ç½®è¦ä»¥ç»å¯¹è·¯å¾„å†™æ˜ï¼Œ<code class="highlighter-rouge">-r</code> ä¼ è¾“æ•´ä¸ªæ–‡ä»¶å¤¹</p>
</blockquote>

<h5 id="scp-ä¼ è¾“æ–‡ä»¶">scp ä¼ è¾“æ–‡ä»¶</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">echo</span> <span class="s2">"Welcome to LinuxProbe.Com"</span> <span class="o">&gt;</span> readme.txt
<span class="o">&gt;&gt;&gt;</span> scp /root/readme.txt  192.168.10.20:/home
root@192.168.10.20<span class="s1">'s password:æ­¤å¤„è¾“å…¥è¿œç¨‹æœåŠ¡å™¨ä¸­rootç®¡ç†å‘˜çš„å¯†ç 
readme.txt 100% 26 0.0KB/s 00:00
</span></code></pre></div></div>

<h5 id="scp-ä¸‹è½½æ–‡ä»¶">scp ä¸‹è½½æ–‡ä»¶</h5>

<p>æ ¼å¼ï¼š<code class="highlighter-rouge">scp [å‚æ•°] è¿œç¨‹ç”¨æˆ·@è¿œç¨‹IPåœ°å€:è¿œç¨‹æ–‡ä»¶ æœ¬åœ°ç›®å½•</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> scp 192.168.10.20:/etc/redhat-release /root
root@192.168.10.20<span class="s1">'s password:æ­¤å¤„è¾“å…¥è¿œç¨‹æœåŠ¡å™¨ä¸­rootç®¡ç†å‘˜çš„å¯†ç 
redhat-release 100% 52 0.1KB/s 00:00
</span></code></pre></div></div>

<h3 id="ä¸é—´æ–­ä¼šè¯æœåŠ¡">ä¸é—´æ–­ä¼šè¯æœåŠ¡</h3>

<p>å½“æˆ‘ä»¬ä¸è¿œç¨‹ä¸»æœºä¼šè¯å…³é—­åï¼Œåœ¨è¿œç¨‹ä¸»æœºä¸Šçš„å‘½ä»¤ä¹Ÿä¼šéšä¹‹å…³é—­ï¼Œä¸ºäº†é¿å…è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ screen æˆ– tmux è½¯ä»¶ã€‚è¿™é‡Œä¸è¿‡å¤šè¯´æ˜ï¼Œå¯ä»¥çœ‹ tmux ç« èŠ‚</p>

<h3 id="selinux-å®‰å…¨å­ç³»ç»Ÿ">SELinux å®‰å…¨å­ç³»ç»Ÿ</h3>

<p>SELinux æœåŠ¡çš„ä¸»é…ç½®æ–‡ä»¶ä¸­ï¼Œå®šä¹‰çš„æ˜¯ SELinux çš„é»˜è®¤è¿è¡ŒçŠ¶æ€ï¼Œå¯ä»¥å°†å…¶ç†è§£ä¸ºç³»ç»Ÿé‡å¯åçš„çŠ¶æ€ï¼Œå› æ­¤å®ƒä¸ä¼šåœ¨æ›´æ”¹åç«‹å³ç”Ÿæ•ˆã€‚å¯ä»¥ä½¿ç”¨ getenforce å‘½ä»¤è·å¾—å½“å‰ SELinux æœåŠ¡çš„è¿è¡Œæ¨¡å¼ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> getenforce
Enforcing
</code></pre></div></div>

<table>
  <tbody>
    <tr>
      <td>ç”¨ setenforce [0</td>
      <td>1]å‘½ä»¤ä¿®æ”¹ SELinux å½“å‰çš„è¿è¡Œæ¨¡å¼ï¼ˆ0 ä¸ºç¦ç”¨ï¼Œ1 ä¸ºå¯ç”¨ï¼‰ã€‚æ³¨æ„ï¼Œè¿™ç§ä¿®æ”¹åªæ˜¯ä¸´æ—¶çš„ï¼Œåœ¨ç³»ç»Ÿé‡å¯åå°±ä¼šå¤±æ•ˆ</td>
    </tr>
  </tbody>
</table>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> setenforce 0
<span class="o">&gt;&gt;&gt;</span> getenforce
Permissive
</code></pre></div></div>

<p>å› ä¸º httpd æœåŠ¡å…è®¸ç”¨æˆ·è®¿é—®ç½‘ç«™å†…å®¹ï¼ŒSELinux ä¼šæ”¾è¡Œç”¨æˆ·å¯¹ç½‘ç«™çš„è¯·æ±‚æ“ä½œã€‚ä½†ç½‘ç«™æ•°æ®ä¿®æ”¹ä¸º <code class="highlighter-rouge">/home/wwwroot</code>ï¼Œè¿™æ˜¯æ™®é€šç”¨æˆ·çš„ç›®å½•ï¼Œhttpd ç½‘ç«™æœåŠ¡è¦è·å–æ™®é€šç”¨æˆ·æ•°æ®ï¼Œè¿åäº† SELinux çš„ç›‘ç®¡åŸåˆ™ã€‚</p>

<p>æŠŠ SELinux æœåŠ¡æ¢å¤åˆ°å¼ºåˆ¶å®‰å…¨ç­–ç•¥æ¨¡å¼ï¼Œç„¶åå†æŸ¥çœ‹åŸå§‹ç½‘ç«™æ•°æ®çš„ä¿å­˜ç›®å½•ä¸å½“å‰ç½‘ç«™æ•°æ®çš„ä¿å­˜ç›®å½•æ˜¯å¦æ‹¥æœ‰ä¸åŒçš„ SELinux å®‰å…¨ä¸Šä¸‹æ–‡ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> setenforce 1
<span class="o">&gt;&gt;&gt;</span> <span class="nb">ls</span> <span class="nt">-Zd</span> /var/www/html
drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 /var/www/html

<span class="o">&gt;&gt;&gt;</span> <span class="nb">ls</span> <span class="nt">-Zd</span> /home/wwwroot
drwxrwxrwx. root root unconfined_u:object_r:home_root_t:s0 /home/wwwroot
</code></pre></div></div>

<p>SELinux å®‰å…¨ä¸Šä¸‹æ–‡ç”±<strong>ç”¨æˆ·æ®µ</strong>ã€<strong>è§’è‰²æ®µ</strong>ä»¥åŠ<strong>ç±»å‹æ®µ</strong>ç­‰å¤šä¸ªä¿¡æ¯é¡¹å…±åŒç»„æˆã€‚</p>

<table>
  <thead>
    <tr>
      <th>ä¿¡æ¯é¡¹</th>
      <th>åŠŸèƒ½</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">system_u</code></td>
      <td>ç”¨æˆ·æ®µï¼Œä»£è¡¨ç³»ç»Ÿè¿›ç¨‹çš„èº«ä»½</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">object_r</code></td>
      <td>è§’è‰²æ®µï¼Œä»£è¡¨æ–‡ä»¶ç›®å½•çš„è§’è‰²</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">httpd_sys_content_t</code></td>
      <td>ç±»å‹æ®µï¼Œä»£è¡¨ç½‘ç«™æœåŠ¡çš„ç³»ç»Ÿæ–‡ä»¶</td>
    </tr>
  </tbody>
</table>

<p>é€šè¿‡å‘½ä»¤ semanageï¼ŒæŠŠå½“å‰ç½‘ç«™ç›®å½• <code class="highlighter-rouge">/home/wwwroot</code> çš„ SELinux å®‰å…¨ä¸Šä¸‹æ–‡æ”¹ä¸ºåŸå§‹ç½‘ç«™ç›®å½•ä¸€è‡´å³å¯</p>

<h4 id="semange-å‘½ä»¤">semange å‘½ä»¤</h4>

<p>semange æ˜¯ç®¡ç† SELinux ç­–ç•¥çš„å‘½ä»¤ï¼Œæ ¼å¼ä¸ºï¼š<code class="highlighter-rouge">semange [é€‰é¡¹] [æ–‡ä»¶]</code></p>

<h5 id="semange-å‚æ•°">semange å‚æ•°</h5>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>åŠŸèƒ½</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">-l</code></td>
      <td>æŸ¥è¯¢</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">-a</code></td>
      <td>æ·»åŠ </td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">-m</code></td>
      <td>ä¿®æ”¹</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">-d</code></td>
      <td>åˆ é™¤</td>
    </tr>
  </tbody>
</table>

<h5 id="ç¤ºä¾‹-1">ç¤ºä¾‹</h5>

<h6 id="è®©ç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶å¯è¢«-httpd-æœåŠ¡è®¿é—®">è®©ç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶å¯è¢« httpd æœåŠ¡è®¿é—®</h6>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> semange fcontext <span class="nt">-a</span> <span class="nt">-t</span> httpd_sys_content_t /home/wwwroot
<span class="o">&gt;&gt;&gt;</span> semange fcontext <span class="nt">-a</span> <span class="nt">-t</span> httpd_sys_content_t /home/wwwroot/<span class="k">*</span>
<span class="c"># å°†è®¾ç½®å¥½çš„SELinuxå®‰å…¨ä¸Šä¸‹æ–‡ç”Ÿæ•ˆ -Rv å¯¹ç›®å½•é€’å½’</span>
<span class="o">&gt;&gt;&gt;</span> restorecon <span class="nt">-Rv</span> /home/wwwroot/
restorecon reset /home/wwwroot context unconfined_u:object_r:home_root_t:s0-&gt;unconfined_u:object_r:httpd_sys_content_t:s0
restorecon reset /home/wwwroot/index.html context unconfined_u:object_r:home_root_t:s0-&gt;unconfined_u:object_r:httpd_sys_content_t:s0
</code></pre></div></div>

<blockquote>
  <p>æ—¥å¸¸å·¥ä½œä¸­è¦å…»æˆå°†æ‰€éœ€æœåŠ¡æ·»åŠ åˆ°å¼€æœºå¯åŠ¨é¡¹ä¸­çš„ä¹ æƒ¯ï¼Œæ¯”å¦‚è¿™é‡Œå°±éœ€è¦æ·»åŠ  systemctl enable httpd å‘½ä»¤</p>
</blockquote>

<h3 id="ä¸ªäººç”¨æˆ·ä¸»é¡µåŠŸèƒ½">ä¸ªäººç”¨æˆ·ä¸»é¡µåŠŸèƒ½</h3>

<p>ä¸ºæ¯ä½ç”¨æˆ·å»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„ç½‘ç«™ï¼Œæ–¹æ³•æ˜¯åŸºäº<strong>è™šæ‹Ÿç½‘ç«™ä¸»æœºåŠŸèƒ½</strong>æ¥éƒ¨ç½²å¤šä¸ªç½‘ç«™ã€‚ä½†ç”¨æˆ·è¿‡å¤šçš„è¯ï¼Œé…ç½®è¿‡äºç¹æ‚ã€‚å¥½æ–¹æ³•æ˜¯åˆ©ç”¨ httpd æœåŠ¡ç¨‹åºæä¾›çš„ä¸ªäººç”¨æˆ·ä¸»é¡µåŠŸèƒ½ã€‚è¯¥åŠŸèƒ½å¯ä»¥è®©ç³»ç»Ÿå†…æ‰€æœ‰çš„ç”¨æˆ·åœ¨è‡ªå·±çš„å®¶ç›®å½•ä¸­ç®¡ç†ä¸ªäººçš„ç½‘ç«™ï¼Œè€Œä¸”è®¿é—®èµ·æ¥ä¹Ÿéå¸¸å®¹æ˜“ã€‚</p>

<h4 id="é…ç½®æ­¥éª¤">é…ç½®æ­¥éª¤</h4>

<ol>
  <li>
    <p>å¼€å¯ä¸ªäººç”¨æˆ·ä¸»é¡µåŠŸèƒ½</p>

    <ul>
      <li>åœ¨ 17 è¡Œ <code class="highlighter-rouge">UserDir disabled</code> æ³¨é‡Šæ‰</li>
      <li>24 è¡Œï¼Œæ‰“å¼€ <code class="highlighter-rouge">UserDir public_html</code></li>
    </ul>

    <blockquote>
      <p>UserDir è¡¨ç¤ºç½‘ç«™æ•°æ®åœ¨ç”¨æˆ· home ä¸­çš„ä¿å­˜ç›®å½•åç§°ï¼Œå³ <code class="highlighter-rouge">public_html</code></p>
    </blockquote>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> vim /etc/httpd/conf.d/userdir.conf
1 <span class="c">#</span>
2 <span class="c"># UserDir: The name of the directory that is appended onto a user's home</span>
3 <span class="c"># directory if a ~user request is received.</span>
4 <span class="c">#</span>
5 <span class="c"># The path to the end user account 'public_html' directory must be</span>
6 <span class="c"># accessible to the webserver userid. This usually means that ~userid</span>
7 <span class="c"># must have permissions of 711, ~userid/public_html must have permissions</span>
8 <span class="c"># of 755, and documents contained therein must be world-readable.</span>
9 <span class="c"># Otherwise, the client will only receive a "403 Forbidden" message.</span>
10 <span class="c">#</span>
11 &lt;IfModule mod_userdir.c&gt;
12 <span class="c">#</span>
13 <span class="c"># UserDir is disabled by default since it can confirm the presence</span>
14 <span class="c"># of a username on the system (depending on home directory</span>
15 <span class="c"># permissions).</span>
16 <span class="c">#</span>
17 <span class="c"># UserDir disabled</span>
18
19 <span class="c">#</span>
20 <span class="c"># To enable requests to /~user/ to serve the user's public_html</span>
21 <span class="c"># directory, remove the "UserDir disabled" line above, and uncomment</span>
22 <span class="c"># the following line instead:</span>
23 <span class="c">#</span>
24   UserDir public_html
25 &lt;/IfModule&gt;
26
27 <span class="c">#</span>
28 <span class="c"># Control access to UserDir directories. The following is an example</span>
29 <span class="c"># for a site where these directories are restricted to read-only.</span>
30 <span class="c">#</span>
31 &lt;Directory <span class="s2">"/home/*/public_html"</span><span class="o">&gt;</span>
32 AllowOverride FileInfo AuthConfig Limit Indexes
33 Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
34 Require method GET POST OPTIONS
35 &lt;/Directory&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>å»ºç«‹ç½‘ç«™æ•°æ®ç›®å½•åŠé¦–é¡µæ–‡ä»¶</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> su - wilson
Last login: Fri May 22 13:17:37 CST 2017 on :0

<span class="o">&gt;&gt;&gt;</span> <span class="nb">mkdir </span>public_html
<span class="o">&gt;&gt;&gt;</span> <span class="nb">echo</span> <span class="s2">"è¿™æ˜¯wilsonçš„ç½‘ç«™"</span> <span class="o">&gt;</span> public_html/index.html
<span class="c"># ä¿è¯å…¶ä»–äººæœ‰æƒé™è¯»å–é‡Œé¢å†…å®¹</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">chmod</span> <span class="nt">-Rf</span> 755 /home/wilson
</code></pre></div>    </div>
  </li>
  <li>
    <p>é‡å¯ httpd æœåŠ¡ï¼Œè¾“å…¥ç½‘ç«™åœ°å€ <code class="highlighter-rouge">127.0.01/~wilson</code></p>

    <blockquote>
      <p>â€œç½‘å€/~ç”¨æˆ·åâ€ï¼ˆå…¶ä¸­çš„æ³¢æµªå·æ˜¯å¿…éœ€çš„ï¼Œè€Œä¸”ç½‘å€ã€æ³¢æµªå·ã€ç”¨æˆ·åä¹‹é—´æ²¡æœ‰ç©ºæ ¼ï¼‰</p>
    </blockquote>

    <p>ä½†ç»“æœä¸ºï¼š</p>

    <p><img src="error.png" alt="error" /></p>

    <p>åŸå› åˆ†æï¼š</p>

    <ul>
      <li>httpd æœåŠ¡æä¾›çš„ä¸ªäººä¸»é¡µåŠŸèƒ½ï¼Œç”¨æˆ·çš„ç½‘ç«™æ•°æ®å°±åº”è¯¥å­˜æ”¾ç”¨æˆ·å®¶ç›®å½•ï¼Œæ‰€ä»¥ä¸éœ€è¦ä¿®æ”¹å®¶ç›®å½•çš„ SELinux å®‰å…¨ä¸Šä¸‹æ–‡</li>
      <li>SELinux åŸŸç¡®ä¿æœåŠ¡ç¨‹åºä¸èƒ½æ‰§è¡Œè¿è§„çš„æ“ä½œï¼Œhttpd æœåŠ¡ä¸­å¼€å¯çš„è¿™é¡¹ä¸ªäººç”¨æˆ·ä¸»é¡µåŠŸèƒ½æ²¡æœ‰è¢« SELinux åŸŸå…è®¸</li>
    </ul>

    <p>ç”¨ getsebool æŸ¥è¯¢ä¸ http ç›¸å…³çš„å®‰å…¨ç­–ç•¥ï¼š</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> getsebool <span class="nt">-a</span> | <span class="nb">grep </span>http
httpd_anon_write <span class="nt">--</span><span class="o">&gt;</span> off
httpd_builtin_scripting <span class="nt">--</span><span class="o">&gt;</span> on
httpd_can_check_spam <span class="nt">--</span><span class="o">&gt;</span> off
httpd_can_connect_ftp <span class="nt">--</span><span class="o">&gt;</span> off
httpd_can_connect_ldap <span class="nt">--</span><span class="o">&gt;</span> off
httpd_can_connect_mythtv <span class="nt">--</span><span class="o">&gt;</span> off
httpd_can_connect_zabbix <span class="nt">--</span><span class="o">&gt;</span> off
... ...
<span class="c"># ä¸ä¸ªäººä¸»é¡µåŠŸèƒ½æœ‰å…³çš„SELinuxåŸŸå®‰å…¨ç­–ç•¥</span>
httpd_enable_homedirs <span class="nt">--</span><span class="o">&gt;</span> off
... ...
httpd_use_gpg <span class="nt">--</span><span class="o">&gt;</span> off
httpd_use_nfs <span class="nt">--</span><span class="o">&gt;</span> off
httpd_use_openstack <span class="nt">--</span><span class="o">&gt;</span> off
httpd_use_sasl <span class="nt">--</span><span class="o">&gt;</span> off
httpd_verify_dns <span class="nt">--</span><span class="o">&gt;</span> off
named_tcp_bind_http_port <span class="nt">--</span><span class="o">&gt;</span> off
prosody_bind_http_port <span class="nt">--</span><span class="o">&gt;</span> off
</code></pre></div>    </div>
  </li>
  <li>
    <p>è®¾ç½® SELinux åŸŸå®‰å…¨ç­–ç•¥</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> setsebool <span class="nt">-P</span> <span class="nv">httpd_enable_homedirs</span><span class="o">=</span>on
<span class="o">&gt;&gt;&gt;</span> firefox
</code></pre></div>    </div>

    <blockquote>
      <p><code class="highlighter-rouge">-P</code> å‚æ•°è®© SELinux ç­–ç•¥æ°¸ä¹…ç”Ÿæ•ˆåŒæ—¶ç«‹å³ç”Ÿæ•ˆ</p>
    </blockquote>

    <p>æ­£å¸¸æ˜¾ç¤ºç½‘é¡µï¼š</p>

    <p><img src="ok.png" alt="ok" /></p>
  </li>
</ol>

<h4 id="ç½‘ç«™ä¸­æ·»åŠ å£ä»¤åŠŸèƒ½">ç½‘ç«™ä¸­æ·»åŠ å£ä»¤åŠŸèƒ½</h4>

<ol>
  <li>
    <p>ä½¿ç”¨ htpasswd ç”Ÿæˆå¯†ç æ•°æ®åº“</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> htpasswd <span class="nt">-c</span> /etc/httpd/passwd wilson
New password:æ­¤å¤„è¾“å…¥ç”¨äºç½‘é¡µéªŒè¯çš„å¯†ç 
Re-type new password:å†è¾“å…¥ä¸€éè¿›è¡Œç¡®è®¤
Adding password <span class="k">for </span>user wilson
</code></pre></div>    </div>

    <blockquote>
      <p><code class="highlighter-rouge">-c</code>ï¼šè¡¨ç¤ºç¬¬ä¸€æ¬¡ç”Ÿæˆ
åé¢ï¼šå¯†ç æ•°æ®åº“ä¿å­˜åˆ°çš„æ–‡ä»¶
éªŒè¯è¦ç”¨åˆ°çš„ç”¨æˆ·åï¼ˆä¸å¿…æ˜¯å·²æœ‰çš„æœ¬åœ°å¸æˆ·ï¼‰</p>
    </blockquote>
  </li>
  <li>
    <p>ä¿®æ”¹ä¸ªäººç”¨æˆ·ä¸»é¡µåŠŸèƒ½</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> vim /etc/httpd/conf.d/userdir.conf
27 <span class="c">#</span>
28 <span class="c"># Control access to UserDir directories. The following is an example</span>
29 <span class="c"># for a site where these directories are restricted to read-only.</span>
30 <span class="c">#</span>
31 &lt;Directory <span class="s2">"/home/*/public_html"</span><span class="o">&gt;</span>
32 AllowOverride all

<span class="c">#åˆšåˆšç”Ÿæˆå‡ºæ¥çš„å¯†ç éªŒè¯æ–‡ä»¶ä¿å­˜è·¯å¾„</span>
33 authuserfile <span class="s2">"/etc/httpd/passwd"</span> <span class="c">#å½“ç”¨æˆ·å°è¯•è®¿é—®ä¸ªäººç”¨æˆ·ç½‘ç«™æ—¶çš„æç¤ºä¿¡æ¯</span>
34 authname <span class="s2">"My privately website"</span>
35 authtype basic <span class="c">#ç”¨æˆ·è¿›è¡Œè´¦æˆ·å¯†ç ç™»å½•æ—¶éœ€è¦éªŒè¯çš„ç”¨æˆ·åç§°</span>
36 require user linuxprobe
37 &lt;/Directory&gt; <span class="o">&gt;&gt;&gt;</span> systemctl restart httpd
</code></pre></div>    </div>
  </li>
</ol>

<p>æ­¤åï¼Œå½“ç”¨æˆ·å†æƒ³è®¿é—®æŸä¸ªç”¨æˆ·çš„ä¸ªäººç½‘ç«™æ—¶ï¼Œå°±å¿…é¡»è¦è¾“å…¥è´¦æˆ·å’Œå¯†ç æ‰èƒ½æ­£å¸¸è®¿é—®äº†ã€‚å¦å¤–ï¼ŒéªŒè¯æ—¶ä½¿ç”¨çš„è´¦æˆ·å’Œå¯†ç æ˜¯ç”¨ htpasswd å‘½ä»¤ç”Ÿæˆçš„ä¸“é—¨ç”¨äºç½‘ç«™ç™»å½•çš„å£ä»¤å¯†ç ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿä¸­çš„ç”¨æˆ·å¯†ç </p>

<h3 id="è™šæ‹Ÿç½‘ç«™ä¸»æœºåŠŸèƒ½">è™šæ‹Ÿç½‘ç«™ä¸»æœºåŠŸèƒ½</h3>

<p>åœ¨è™šæ‹Ÿä¸“ç”¨æœåŠ¡å™¨ï¼ˆVirtual Private Serverï¼ŒVPSï¼‰ä¸äº‘è®¡ç®—æŠ€æœ¯è¯ç”Ÿä»¥å‰ï¼ŒIDC æœåŠ¡ä¾›åº”å•†ä¸ºäº†èƒ½å¤Ÿæ›´å……åˆ†åœ°åˆ©ç”¨æœåŠ¡å™¨èµ„æºï¼Œå¯ç”¨äº†è™šæ‹Ÿä¸»æœºåŠŸèƒ½ã€‚æŠŠä¸€å°å¤„äºè¿è¡ŒçŠ¶æ€çš„ç‰©ç†æœåŠ¡å™¨åˆ†å‰²æˆå¤šä¸ªâ€œè™šæ‹Ÿçš„æœåŠ¡å™¨â€ã€‚ä½†æ˜¯ï¼Œè¯¥æŠ€æœ¯æ— æ³•å®ç°ç›®å‰äº‘ä¸»æœºæŠ€æœ¯çš„ç¡¬ä»¶èµ„æºéš”ç¦»ã€‚</p>

<p>Apache çš„è™šæ‹Ÿä¸»æœºåŠŸèƒ½æ˜¯æœåŠ¡å™¨åŸºäºç”¨æˆ·è¯·æ±‚çš„ä¸åŒ IP åœ°å€ã€ä¸»æœºåŸŸåæˆ–ç«¯å£å·ï¼Œå®ç°å¤šä¸ªç½‘ç«™åŒæ—¶ä¸ºå¤–éƒ¨æä¾›è®¿é—®æœåŠ¡çš„æŠ€æœ¯ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œç”¨æˆ·è¯·æ±‚çš„èµ„æºä¸åŒï¼Œæœ€ç»ˆè·å–åˆ°çš„ç½‘é¡µå†…å®¹ä¹Ÿå„ä¸ç›¸åŒã€‚</p>

<p><img src="requests.png" alt="request" /></p>

<h4 id="åŸºäº-ip-åœ°å€">åŸºäº IP åœ°å€</h4>

<p>å¦‚æœä¸€å°æœåŠ¡å™¨æœ‰å¤šä¸ª IP åœ°å€ï¼Œè€Œä¸”æ¯ä¸ª IP åœ°å€å¯¹åº”äºæœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„ä¸€ä¸ªç½‘ç«™ï¼Œè¿™æ ·å½“ç”¨æˆ·è¯·æ±‚è®¿é—®ä¸åŒçš„ IP åœ°å€æ—¶ï¼Œä¼šè®¿é—®åˆ°ä¸åŒç½‘ç«™çš„é¡µé¢èµ„æºã€‚ç°åœ¨å‡è®¾æœ‰ 3 å¼ ç½‘å¡ï¼Œé€šè¿‡ nmtui é…ç½®å¦‚ä¸‹ï¼š</p>

<p><img src="mntui.png" alt="nmtui" /></p>

<ol>
  <li>
    <p>åˆ›å»º 3 ä¸ªç½‘ç«™ç›®å½•</p>

    <p>åœ¨<code class="highlighter-rouge">/home/wwwroot</code>ä¸­åˆ›å»ºä¿å­˜ä¸åŒç½‘ç«™æ•°æ®çš„ 3 ä¸ªç›®å½•ï¼Œå¹¶å‘å…¶ä¸­åˆ†åˆ«å†™å…¥ç½‘ç«™çš„é¦–é¡µæ–‡ä»¶</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> systemctl restart network
<span class="o">&gt;&gt;&gt;</span><span class="c"># mkdir -p /home/wwwroot/10</span>
<span class="o">&gt;&gt;&gt;</span><span class="c"># mkdir -p /home/wwwroot/20</span>
<span class="o">&gt;&gt;&gt;</span><span class="c"># mkdir -p /home/wwwroot/30</span>
<span class="o">&gt;&gt;&gt;</span><span class="c"># echo "IP:192.168.10.10" &gt; /home/wwwroot/10/index.html</span>
<span class="o">&gt;&gt;&gt;</span><span class="c"># echo "IP:192.168.10.20" &gt; /home/wwwroot/20/index.html</span>
<span class="o">&gt;&gt;&gt;</span><span class="c"># echo "IP:192.168.10.30" &gt; /home/wwwroot/30/index.html</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>è¿½åŠ  3 ä¸ªè™šæ‹Ÿä¸»æœºç½‘ç«™å‚æ•°</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> vim /etc/httpd/conf/httpd.conf
â€¦â€¦â€¦â€¦â€¦â€¦çœç•¥éƒ¨åˆ†è¾“å‡ºä¿¡æ¯â€¦â€¦â€¦â€¦â€¦â€¦
113 &lt;VirtualHost 192.168.10.10&gt;
114 DocumentRoot /home/wwwroot/10
115 ServerName www.wilson.com
116 &lt;Directory /home/wwwroot/10 <span class="o">&gt;</span>
117 AllowOverride None
118 Require all granted
119 &lt;/Directory&gt;
120 &lt;/VirtualHost&gt;
121 &lt;VirtualHost 192.168.10.20&gt;
122 DocumentRoot /home/wwwroot/20
123 ServerName bbs.linuxprobe.com
124 &lt;Directory /home/wwwroot/20 <span class="o">&gt;</span>
125 AllowOverride None
126 Require all granted
127 &lt;/Directory&gt;
128 &lt;/VirtualHost&gt;
129 &lt;VirtualHost 192.168.10.30&gt;
130 DocumentRoot /home/wwwroot/30
131 ServerName tech.linuxprobe.com
132 &lt;Directory /home/wwwroot/30 <span class="o">&gt;</span>
133 AllowOverride None
134 Require all granted
135 &lt;/Directory&gt;
136 &lt;/VirtualHost&gt;
â€¦â€¦â€¦â€¦â€¦â€¦çœç•¥éƒ¨åˆ†è¾“å‡ºä¿¡æ¯â€¦â€¦â€¦â€¦â€¦â€¦

<span class="o">&gt;&gt;&gt;</span> systemctl restart httpd
</code></pre></div>    </div>
  </li>
  <li>
    <p>è®¾ç½® SELinux</p>

    <p>ç”±äºå½“å‰çš„<code class="highlighter-rouge">/home/wwwroot</code> ç›®å½•åŠé‡Œé¢çš„ç½‘ç«™æ•°æ®ç›®å½•çš„ SELinux å®‰å…¨ä¸Šä¸‹æ–‡ä¸ç½‘ç«™æœåŠ¡ä¸ç¬¦ï¼Œæ‰€ä»¥ httpd æœåŠ¡æ— æ³•å–åˆ°ç½‘ç«™æ•°æ®ç›®å½•ã€‚</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> semange fcontext <span class="nt">-a</span> <span class="nt">-t</span> httpd_sys_content_t /home/wwwroot
<span class="o">&gt;&gt;&gt;</span> semange fcontext <span class="nt">-a</span> <span class="nt">-t</span> httpd_sys_content_t /home/wwwroot/10
<span class="o">&gt;&gt;&gt;</span> semange fcontext <span class="nt">-a</span> <span class="nt">-t</span> httpd_sys_content_t /home/wwwroot/10/<span class="k">*</span>
<span class="o">&gt;&gt;&gt;</span> semange fcontext <span class="nt">-a</span> <span class="nt">-t</span> httpd_sys_content_t /home/wwwroot/20
<span class="o">&gt;&gt;&gt;</span> semange fcontext <span class="nt">-a</span> <span class="nt">-t</span> httpd_sys_content_t /home/wwwroot/20/<span class="k">*</span>
<span class="o">&gt;&gt;&gt;</span> semange fcontext <span class="nt">-a</span> <span class="nt">-t</span> httpd_sys_content_t /home/wwwroot/30
<span class="o">&gt;&gt;&gt;</span> semange fcontext <span class="nt">-a</span> <span class="nt">-t</span> httpd_sys_content_t /home/wwwroot/30/<span class="k">*</span>
<span class="o">&gt;&gt;&gt;</span> restorecon <span class="nt">-Rv</span> /home/wwwroot
restorecon reset /home/wwwroot context unconfined_u:object_r:home_root_t:s0-&gt;unconfined_u:object_r:httpd_sys_content_t:s0
restorecon reset /home/wwwroot/10 context unconfined_u:object_r:home_root_t:s0-&gt;unconfined_u:object_r:httpd_sys_content_t:s0
restorecon reset /home/wwwroot/10/index.html context unconfined_u:object_r:home_root_t:s0-&gt;unconfined_u:object_r:httpd_sys_content_t:s0

<span class="o">&gt;&gt;&gt;</span> firefox
</code></pre></div>    </div>

    <p><img src="ip.png" alt="ip" /></p>
  </li>
</ol>

<h4 id="åŸºäºä¸»æœºåŸŸå">åŸºäºä¸»æœºåŸŸå</h4>

<p>å½“æœåŠ¡å™¨æ— æ³•ä¸ºæ¯ä¸ªç½‘ç«™éƒ½åˆ†é…ä¸€ä¸ªç‹¬ç«‹ IP åœ°å€çš„æ—¶å€™ï¼Œå¯ä»¥å°è¯•è®© Apache è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·è¯·æ±‚çš„åŸŸåï¼Œä»è€Œæ ¹æ®ä¸åŒçš„åŸŸåè¯·æ±‚æ¥ä¼ è¾“ä¸åŒçš„å†…å®¹ã€‚ç°å‡å®šç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨ IP åœ°å€ä¸ºï¼š192.168.10.10ï¼Œå†æ‰‹å·¥å®šä¹‰ IP ä¸åŸŸåä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚<code class="highlighter-rouge">/etc/hosts</code>æ˜¯ Linux ç³»ç»Ÿä¸­å¼ºåˆ¶æŠŠä¸»æœºåŸŸåè§£æåˆ°æŒ‡å®š IP åœ°å€çš„é…ç½®æ–‡ä»¶ã€‚åªè¦æœ‰è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œå³ä½¿ç½‘å¡å‚æ•°ä¸­æ²¡æœ‰ DNS ä¿¡æ¯ä¹Ÿä¾ç„¶å¯ä»¥å°†åŸŸåè§£æä¸ºæŸä¸ª IP åœ°å€ã€‚</p>

<ol>
  <li>
    <p>æ‰‹å·¥å®šä¹‰ IP ä¸åŸŸå</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> vim /etc/hosts
127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4
::1 localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.10.10 www.wilson.com bbs.wilson.com tech.wilson.com

<span class="o">&gt;&gt;&gt;</span> ping <span class="nt">-c</span> 4 www.wilson.com
PING www.linuxprobe.com <span class="o">(</span>192.168.10.10<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from www.linuxprobe.com <span class="o">(</span>192.168.10.10<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.070 ms
64 bytes from www.linuxprobe.com <span class="o">(</span>192.168.10.10<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.077 ms
64 bytes from www.linuxprobe.com <span class="o">(</span>192.168.10.10<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span>3 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.061 ms
64 bytes from www.linuxprobe.com <span class="o">(</span>192.168.10.10<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span>4 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.069 ms
<span class="nt">---</span> www.linuxprobe.com ping statistics <span class="nt">---</span>
4 packets transmitted, 4 received, 0% packet loss, <span class="nb">time </span>2999ms
rtt min/avg/max/mdev <span class="o">=</span> 0.061/0.069/0.077/0.008 ms
</code></pre></div>    </div>
  </li>
  <li>
    <p>åœ¨ <code class="highlighter-rouge">/home/wwwroot</code> ä¸­åˆ›å»ºä¸‰ä¸ªç›®å½•</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">mkdir</span> <span class="nt">-p</span> /home/wwwroot/www
<span class="o">&gt;&gt;&gt;</span> <span class="nb">mkdir</span> <span class="nt">-p</span> /home/wwwroot/bbs
<span class="o">&gt;&gt;&gt;</span> <span class="nb">mkdir</span> <span class="nt">-p</span> /home/wwwroot/tech
<span class="o">&gt;&gt;&gt;</span> <span class="nb">echo</span> <span class="s2">"www.wilson.com"</span> <span class="o">&gt;</span> /home/wwwroot/www/index.html
<span class="o">&gt;&gt;&gt;</span> <span class="nb">echo</span> <span class="s2">"bbs.wilson.com"</span> <span class="o">&gt;</span> /home/wwwroot/bbs/index.html
<span class="o">&gt;&gt;&gt;</span> <span class="nb">echo</span> <span class="s2">"tech.wilson.com"</span> <span class="o">&gt;</span> /home/wwwroot/tech/index.html
</code></pre></div>    </div>
  </li>
  <li>
    <p>åœ¨ httpd æœåŠ¡é…ç½®æ–‡ä»¶ä¸­å†™å…¥å‚æ•°</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> vim /etc/httpd/conf/httpd.conf
</code></pre></div>    </div>
  </li>
</ol>
:ET