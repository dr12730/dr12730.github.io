---
title: VIM 之应用篇
date: 2019-06-16 17:07:00 +0800
description:
image:
    path: assets/images/posts/2019-06-16-vim-apply/cover.jpg
    thumbnail: assets/images/posts/2019-06-16-vim-apply/thumb.jpg
categories:
    - it
tags:
    - vim
---

这篇文章主要关注如何使用 vim 的插件以及如何配置 `.vimrc`

# 1. vimrc 的编写
vimrc 是 vim 的配置文件，再它打开之前，会先加载这个文件，根据 vimrc 决定编译器自身各类属性的设置以及各种功能的开启和关闭。现在我们来看看这个 vimrc 怎么编写。
首先，在 Linux 下 vimrc 的存放路径是 `~/.vimrc` 或者 `~/.vim/vimrc`，如果没有就自行创建一个，下面是我的配置

```python
mkdir ~/.vim      # 创建.vim 目录
vim ~/.vim/vimrc  # 打开空的 vimrc 文件
```
这样就通过 vim 打开了一个 vimrc 配置文件，下面正式开始配置

```python

" 编辑器设置
set nocompatible    " 不兼容 vi
filetype on         " 打开文件类型识别
filetype indent on  " 根据文件类型设置缩进
filetype plugin on
filetype plugin indent on

set encoding=utf-8

" 设置 vim 的 leader 键为空格
let mapleader=" "
" 打开语法高亮
syntax on
set number
set relativenumber
set wrap
set wildmenu
set hlsearch
exec "nohlsearch"
set incsearch
set ignorecase

" 空格 + 回车，取消搜索高亮
noremap <LEADER><CR> :nohlsearch<CR>

map R :source ~/.vim/vimrc<CR>

" sl 右分屏
map sl :set splitright<CR>:vsplit<CR>
" sh 左分屏
map sh :set nosplitright<CR>:vsplit<CR>
" sj 上分屏
map sj :set nosplitbelow<CR>:split<CR>
" sk 下分屏
map sk :set splitbelow<CR>:split<CR>

" 分屏移动
map <LEADER>l <C-w>l
map <LEADER>j <C-w>j
map <LEADER>k <C-w>k
map <LEADER>h <C-w>h

" 分屏大小
map <up> :res +5<CR>
map <down> :res -5<CR>
map left<> :vertical resize-5<CR>
map <right> :vertical resize+5<CR>

" 分屏布局
" 上下分屏
map sv <C-w>t<C-w>H
map sh <C-w>t<C-w>J

" 标签页
" 创建新的标签页
map tn :tabe<CR>
" 移动到左边标签页
map tl :tabnext<CR>
" 移动到右边签页
map th :-tabnext<CR>

```

# 2. NerdTree 使用
NerdTree 是一个树形的文件管理器，它可以让你用键盘或鼠标操作文件系统，它也可以执行文件系统的指令。


它的快捷键如下：

| 序号 | 快捷键 | 说明 |
| :---: | :---: | --- |
| 1 | o | 在已有窗口中打开文件、目录或书签，并跳到该窗口  |
| 2 | go| 在已有窗口 中打开文件、目录或书签，但不跳到该窗口  |
| 3 | t | 在新 Tab 中打开选中文件 / 书签，并跳到新 Tab  |
| 4 | T | 在新 Tab 中打开选中文件 / 书签，但不跳到新 Tab  |
| 5 | i   |    split 一个新窗口打开选中文件，并跳到该窗口 |
| 6 | gi  |    split 一个新窗口打开选中文件，但不跳到该窗口 |
| 7 | s   |    vsplit 一个新窗口打开选中文件，并跳到该窗口 |
| 8 | gs  |    vsplit 一个新 窗口打开选中文件，但不跳到该窗口 |
| 9 | !   |    执行当前文件 |
| 10 | O   |    递归打开选中 结点下的所有目录 |
| 11| x   |    合拢选中结点的父目录 |
| 12| X   |    递归 合拢选中结点下的所有目录 |
| 13| e   |    Edit the current dif |
| 14 | 双击|    相当于 NERDTree-o |
| 15 | 中键|    对文件相当于 NERDTree-i，对目录相当于 NERDTree-e |
| 16 | D   |    删除当前书签 |
| 17 | P   |    跳到根结点 |
| 18 | p   |    跳到父结点 |
| 19 | K   |    跳到当前目录下同级的第一个结点 |
| 20 | J   |    跳到当前目录下同级的最后一个结点 |
| 21 | k   |    跳到当前目录下同级的前一个结点 |
| 22 | j   |    跳到当前目录下同级的后一个结点 |
| 23 | C   |    将选中目录或选中文件的父目录设为根结点 |
| 24 | u   |    将当前根结点的父目录设为根目录，并变成合拢原根结点 |
| 25 | U   |    将当前根结点的父目录设为根目录，但保持展开原根结点 |
| 26 | r   |    递归刷新选中目录 |
| 27 | R   |    递归刷新根结点 |
| 28 | m   |    显示文件系统菜单 |
| 29 | cd  |    将 CWD 设为选中目录 |
| 30 | I   |    切换是否显示隐藏文件 |
| 31 | f   |    切换是否使用文件过滤器 |
| 32 | F   |    切换是否显示文件 |
| 33 | B   |    切换是否显示书签 |
| 34 | q   |    关闭 NerdTree 窗口 |
| 35 | ?   |    切换是否显示 Quick Help |


# 3. Airline 的使用

Airline 是 vim 的状态栏插件，它由几个部分组成，每个部分显示一些信息。默认情况下（无配置），如下所示：

![airline](assets/images/posts/2019-06-16-vim-apply/airline.png)


```
+-----------------------------------------------------------------------------+
|~                                                                            |
|~                                                                            |
|~                     VIM - Vi IMproved                                      |
|~                                                                            |
|~                       version 8.0                                          |
|~                    by Bram Moolenaar et al.                                |
|~           Vim is open source and freely distributable                      |
|~                                                                            |
|~           type :h :q<Enter>          to exit                               |
|~           type :help<Enter> or <F1>  for on-line help                      |
|~           type :help version8<Enter> for version info                      |
|~                                                                            |
|~                                                                            |
+-----------------------------------------------------------------------------+
| A | B |                     C                            X | Y | Z |  [...] |
+-----------------------------------------------------------------------------+
```

其中含义如下：


|序号 | 部分 | 说明 |
|:---:|----|----|
| 1 | A | 显示模式 + 附加标志，如加密 / 拼写 / 粘贴（插入） |
| 2 | B | VCS 信息（分支，大块摘要） |
| 3 | C | 文件名 + 只读标志 (~/.vim/vimrc RO) |
| 4 | X | 文件类型 |
| 5 | Y | 文件编码『文件格式』 (utf-8[unix) |
| 6 | Z | 文件中的当前位置 |
| 7 | [...] | 自外部插件的附加部分（警告 / 错误 / 统计）（例如 YCM，syntastic，...）|

Z 段的信息 `10% ☰ 10/100 ln : 20` 含义如下：

```python
10% 	# 文件顶部向下 10%
☰ 10 	# 当前行：10
/100 LN	# 总共 100 行
:20	# 当前列：20

```

# 4. YouCompleteMe 插件
YCM 是一款广受赞誉的补全插件，但也出了名的难以安装。下面是安装的要求和步骤：

## 4.1 Python 版本
	YCM 要求用来编译 YCM 的 python 版本是通过 `--enabled-shared` 编译安装的版本，所以在安装 YCM 之前，我们需要安装支持共享对象的 python。

1. 下载 python 源码
	以 python3.7 为例，下载源码包并解压，得到 Python-3.7 目录

2. 编译并安装
	```python
	# 进入 python 源码目录
	cd python3.7

	# 清除临时文件
	make distclean

	# 配置 python 版本，支持共享对象，安装目录为 /usr/local/
	./configure --enable-shared --prefix=/usr/local/

	# 编译
	make

	# 安装
	sudo make install
	```
3. 刷新动态连接库
	如果出现类似的问题，可以通过 `sudo ldconfig` 刷新动态连接库解决
	```python
 	/opt/python3/bin/python3.7：加载共享库时出错：libpython3.5m.so.1.0：无法打开共享对象文件：无此类文件或目录
	```

## 4.2 安装 vim
安装了支持共享对象的 python 版本后，下载 vim8.1 源码包，解压后用以下编译指令安装 vim

```python
./configure --with-features=huge --enable-multibyte --enable-python3interp=yes --with-python3-config-dir=/usr/local/lib/python3.8/config-3.8-x86_64-linux-gnu/ --enable-fontset --enable-cscope --enable-fail-if-missing --enable-gtk2-check --prefix=/usr/local
```

## 4.3 安装 YouCompleteMe

1. 在 vimrc 中加入 YCM 插件
2. 在 vim 中执行 `:PlugInstall`，下载 YCM
3. 进入 YCM 目录，一般在`~/.vim/plugged/YouCompleteMe`目录下
4. 执行 `python3.8 install.py --all` 安装 YCM

安装完成后，就可以自动补全了

详细的安装过程，可以参考这篇[文章](https://zhuanlan.zhihu.com/p/33767178)



# 10. VIM 中利用宏来实现插入一列递增或递减序号

1. 进入 VIM，读取文件内容。
2. 在需要加入行号的首行开头输入起始行号（序号）并加入一个空格与后文隔开（空格用于后面的单词复制分隔，如要不希望加入空格也可以用其它方式来框选序号，偶就不一一列举了）。
3. 将光标置于行首（其实就是序号上），按下 q（命令模式下），开始录制操作啦～；再按下 t（偶将宏存到 t 中，大家也可以使用其它字符命名宏，注意是单个字符）
4. 在命令模式下按下 yw，将行序号当作单词复制下来。
5. 按 j 到下一行，现在光标应该正对应到插入位置，按下 P（最好是大写，表明在当前字符前粘贴），将上行序号粘贴到这个位置。
6. 按下 ^（无视空格用 0［零，非欧］），光标回到行首（其实就是回到行序号上，还有其它方法可以实现），按下 **Ctrl-a**，序号会加 1（ **Ctrl-x** 表示减 1，大家明白加 2 减 2……如何处理了吧），然后再次按下 ^，保证光标在行序号开始位置。
7. 按下 q 结束录制。
8. 在光标位于行序号首的情况下，想插入 10 个连续的行号就输入 10@t，10 代表执行次数，@表示执行宏，t 是偶刚才给宏的命名，大家按自己命名使用。

并且，默认情况下这个宏定义不会被清除，只要以后不重新在 t 上定义其它宏，再次重启 VIM 时也可以使用，再次使用时就不用录制了，直接使用就可以了 ^_^。
